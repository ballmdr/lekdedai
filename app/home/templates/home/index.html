{% extends "base.html" %}
{% load static %}

{% block title %}LekDedAI - ‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡πá‡∏î‡∏à‡∏≤‡∏Å AI{% endblock %}

{% block extra_css %}{% endblock %}

{% block content %}

  <!-- Daily Content Hero -->
  <section class="py-12 bg-gradient-to-br from-primary/5 via-background to-secondary/5 relative overflow-hidden">
    <div class="absolute inset-0" style="background: radial-gradient(circle at 30% 20%, rgba(255, 193, 7, 0.1), transparent 50%);"></div>

    <div class="container mx-auto px-4 relative z-10">
      <div class="text-center mb-8">
        <div class="flex items-center justify-center gap-2 mb-4">
          <i class="fas fa-calendar text-primary"></i>
          <span class="text-sm font-medium text-muted-foreground">
            ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà {{ thai_current_date }}
          </span>
        </div>
        <h2 class="text-4xl md:text-5xl font-serif font-bold text-foreground mb-4">‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡πá‡∏î‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</h2>
        <p class="text-lg text-muted-foreground max-w-2xl mx-auto">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡πá‡∏î ‡∏Ç‡πà‡∏≤‡∏ß‡∏´‡∏ß‡∏¢ ‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô</p>
      </div>

      <!-- Today's Featured Numbers -->
      <div class="grid md:grid-cols-3 gap-6 max-w-4xl mx-auto">
        <div class="card border-primary/20 bg-primary/5">
          <div class="p-4 text-center pb-2">
            <h3 class="text-lg font-serif text-foreground mb-2">‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡πá‡∏î AI</h3>
            <div class="badge bg-primary text-primary-foreground mx-auto mb-2">
              <i class="fas fa-star mr-1"></i>
              ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
            </div>
          </div>
          <div class="p-4 pt-0 text-center">
            {% if latest_prediction and latest_prediction.get_three_digit_list %}
              <div class="text-3xl font-bold text-primary mb-2">{{ latest_prediction.get_three_digit_list.0 }}</div>
              <div class="text-sm text-muted-foreground">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ {{ latest_prediction.overall_confidence|floatformat:0 }}%</div>
            {% else %}
              <div class="text-3xl font-bold text-primary mb-2">427</div>
              <div class="text-sm text-muted-foreground">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ 87%</div>
            {% endif %}
          </div>
        </div>

        <div class="card border-secondary/20 bg-secondary/5">
          <div class="p-4 text-center pb-2">
            <h3 class="text-lg font-serif text-foreground mb-2">‡πÄ‡∏•‡∏Ç‡∏Æ‡∏¥‡∏ï</h3>
            <div class="badge badge-secondary mx-auto mb-2">
              <i class="fas fa-chart-line mr-1"></i>
              ‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°
            </div>
          </div>
          <div class="p-4 pt-0 text-center">
            {% if latest_prediction and latest_prediction.get_two_digit_list %}
              <div class="text-3xl font-bold text-secondary mb-2">{{ latest_prediction.get_two_digit_list.0 }}</div>
              <div class="text-sm text-muted-foreground">‡∏≠‡∏≠‡∏Å‡∏ö‡πà‡∏≠‡∏¢</div>
            {% else %}
              <div class="text-3xl font-bold text-secondary mb-2">15</div>
              <div class="text-sm text-muted-foreground">‡∏≠‡∏≠‡∏Å‡∏ö‡πà‡∏≠‡∏¢ 15 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
            {% endif %}
          </div>
        </div>

        <div class="card border-accent/20 bg-accent/5">
          <div class="p-4 text-center pb-2">
            <h3 class="text-lg font-serif text-foreground mb-2">‡πÄ‡∏•‡∏Ç‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏î‡∏ß‡∏á</h3>
            <div class="badge badge-outline mx-auto mb-2">
              <i class="fas fa-moon mr-1"></i>
              ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ù‡∏±‡∏ô
            </div>
          </div>
          <div class="p-4 pt-0 text-center">
            {% if latest_prediction and latest_prediction.get_two_digit_list|length > 1 %}
              <div class="text-3xl font-bold text-accent mb-2">{{ latest_prediction.get_two_digit_list.1 }}</div>
              <div class="text-sm text-muted-foreground">‡∏à‡∏≤‡∏Å AI</div>
            {% else %}
              <div class="text-3xl font-bold text-accent mb-2">89</div>
              <div class="text-sm text-muted-foreground">‡∏ù‡∏±‡∏ô‡πÄ‡∏´‡πá‡∏ô‡∏á‡∏π</div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Daily Stats & Quick Info -->
  <section class="py-8 bg-card/30">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="text-center p-4">
          <div class="text-2xl font-bold text-primary mb-1">{{ site_stats.total_visitors_today|floatformat:0 }}</div>
          <div class="text-sm text-muted-foreground">‡∏Ñ‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ä‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
        </div>
        <div class="text-center p-4">
          <div class="text-2xl font-bold text-secondary mb-1">{{ site_stats.accuracy_percentage }}%</div>
          <div class="text-sm text-muted-foreground">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</div>
        </div>
        <div class="text-center p-4">
          <div class="text-2xl font-bold text-accent mb-1">{{ site_stats.total_predictions }}</div>
          <div class="text-sm text-muted-foreground">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</div>
        </div>
        <div class="text-center p-4">
          <div class="text-2xl font-bold text-primary mb-1">{{ site_stats.total_news_today }}</div>
          <div class="text-sm text-muted-foreground">‡∏Ç‡πà‡∏≤‡∏ß‡πÉ‡∏´‡∏°‡πà‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Main Content Sections -->
  <section class="py-16" id="today">
    <div class="container mx-auto px-4">
      <div class="grid lg:grid-cols-3 gap-8">
        <!-- Left Column - Main Content -->
        <div class="lg:col-span-2 space-y-8">
          <!-- Latest Lottery News -->
          <div>
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-2xl font-serif font-bold text-foreground flex items-center gap-2">
                <i class="fas fa-newspaper text-primary"></i>
                ‡∏Ç‡πà‡∏≤‡∏ß‡∏´‡∏ß‡∏¢‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
              </h3>
              <a href="/news/" class="btn btn-outline">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</a>
            </div>

            <div class="space-y-4">
              {% for article in latest_news %}
              <a href="{{ article.get_absolute_url }}" class="block">
                <div class="card hover:shadow-md transition-shadow">
                  <div class="p-4">
                    <div class="flex gap-4">
                      {% if article.featured_image %}
                        <div class="w-16 h-16 rounded-lg overflow-hidden flex-shrink-0">
                          <img src="{{ article.featured_image.url }}" alt="{{ article.title }}" class="w-full h-full object-cover">
                        </div>
                      {% else %}
                        <div class="w-16 h-16 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0">
                          <i class="fas fa-newspaper text-primary text-2xl"></i>
                        </div>
                      {% endif %}
                      <div class="flex-1">
                        <h4 class="font-semibold mb-2 text-foreground hover:text-primary transition-colors">{{ article.title }}</h4>
                        <p class="text-sm text-muted-foreground mb-2">{{ article.intro|truncatechars:100 }}</p>
                        {% if article.get_extracted_numbers_list %}
                          <div class="flex gap-1 mb-2">
                            {% for number in article.get_extracted_numbers_list|slice:":3" %}
                              <span class="badge badge-outline text-xs">{{ number }}</span>
                            {% endfor %}
                          </div>
                        {% endif %}
                        <div class="flex items-center gap-4 text-xs text-muted-foreground">
                          <span class="flex items-center gap-1">
                            <i class="fas fa-clock"></i>{{ article.published_date|timesince }} ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß
                          </span>
                          <span class="flex items-center gap-1">
                            <i class="fas fa-users"></i>
                            ‡∏≠‡πà‡∏≤‡∏ô {{ article.views }} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </a>
              {% empty %}
              <div class="card hover:shadow-md transition-shadow">
                <div class="p-4">
                  <div class="flex gap-4">
                    <div class="w-16 h-16 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0">
                      <i class="fas fa-newspaper text-primary text-2xl"></i>
                    </div>
                    <div class="flex-1">
                      <h4 class="font-semibold mb-2">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πà‡∏≤‡∏ß‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h4>
                      <p class="text-sm text-muted-foreground mb-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÉ‡∏ô‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á</p>
                    </div>
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>

          <!-- Lottery Locations -->
          <div id="locations">
            <h3 class="text-2xl font-serif font-bold text-foreground mb-6 flex items-center gap-2">
              <i class="fas fa-map-pin text-primary"></i>
              ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡πá‡∏î - ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏´‡∏ß‡∏¢
            </h3>

            <div class="grid md:grid-cols-2 gap-4">
              {% for location in popular_lucky_locations %}
              <a href="{{ location.get_absolute_url }}" class="block">
                <div class="card hover:shadow-md transition-shadow">
                  <div class="p-4">
                    <div class="flex gap-4">
                      {% if location.main_image %}
                        <div class="w-16 h-16 rounded-lg overflow-hidden flex-shrink-0">
                          <img src="{{ location.main_image.url }}" alt="{{ location.name }}" class="w-full h-full object-cover">
                        </div>
                      {% else %}
                        <div class="w-16 h-16 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0">
                          {% if location.category.icon %}
                            <i class="{{ location.category.icon }} text-primary text-xl"></i>
                          {% else %}
                            <i class="fas fa-map-pin text-primary text-xl"></i>
                          {% endif %}
                        </div>
                      {% endif %}
                      <div class="flex-1">
                        <h4 class="font-semibold mb-1 text-foreground hover:text-primary transition-colors">{{ location.name }}</h4>
                        <p class="text-sm text-muted-foreground mb-2">
                          {{ location.province.name }} - {{ location.category.get_name_display }}
                          {% if location.get_lucky_numbers_list %}
                            <br>‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡πà‡∏ô: {{ location.get_lucky_numbers_list|slice:":3"|join:", " }}
                          {% endif %}
                        </p>
                        <div class="flex items-center justify-between">
                          <span class="badge badge-outline text-xs">
                            <i class="fas fa-eye mr-1"></i>
                            {{ location.views_count }} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                          </span>
                          <div class="text-xs text-muted-foreground">
                            <i class="fas fa-navigation mr-1"></i>
                            ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </a>
              {% empty %}
              <!-- Fallback content if no locations found -->
              <div class="card hover:shadow-md transition-shadow">
                <div class="p-4">
                  <div class="flex gap-4">
                    <div class="w-16 h-16 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0">
                      <i class="fas fa-map-pin text-primary text-xl"></i>
                    </div>
                    <div class="flex-1">
                      <h4 class="font-semibold mb-1 text-foreground">‡∏ß‡∏±‡∏î‡πÑ‡∏ú‡πà‡∏•‡πâ‡∏≠‡∏°</h4>
                      <p class="text-sm text-muted-foreground mb-2">‡∏ß‡∏±‡∏î‡∏î‡∏±‡∏á‡∏Ç‡∏≠‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡πá‡∏î ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡∏ö‡πà‡∏≠‡∏¢: 27, 72, 07</p>
                      <div class="flex items-center justify-between">
                        <span class="badge badge-outline text-xs">
                          <i class="fas fa-star mr-1"></i>
                          ‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°
                        </span>
                        <div class="text-xs text-muted-foreground">
                          <i class="fas fa-navigation mr-1"></i>
                          ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="card hover:shadow-md transition-shadow">
                <div class="p-4">
                  <div class="flex gap-4">
                    <div class="w-16 h-16 bg-secondary/10 rounded-lg flex items-center justify-center flex-shrink-0">
                      <i class="fas fa-map-pin text-secondary text-xl"></i>
                    </div>
                    <div class="flex-1">
                      <h4 class="font-semibold mb-1 text-foreground">‡∏®‡∏≤‡∏•‡πÄ‡∏à‡πâ‡∏≤‡∏û‡πà‡∏≠‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏°‡∏∑‡∏≠‡∏á</h4>
                      <p class="text-sm text-muted-foreground mb-2">‡∏®‡∏≤‡∏•‡πÄ‡∏à‡πâ‡∏≤‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå ‡πÄ‡∏•‡∏Ç‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: 89, 98, 19</p>
                      <div class="flex items-center justify-between">
                        <span class="badge badge-secondary text-xs">
                          <i class="fas fa-trophy mr-1"></i>
                          ‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏™‡∏π‡∏á
                        </span>
                        <div class="text-xs text-muted-foreground">
                          <i class="fas fa-navigation mr-1"></i>
                          ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>

            <div class="mt-6 text-center">
              <a href="/lucky_spots/" class="btn btn-outline">
                <i class="fas fa-map-pin mr-2"></i>
                ‡∏î‡∏π‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡πá‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
              </a>
            </div>
          </div>

          <!-- Dream Interpretation -->
          <div>
            <h3 class="text-2xl font-serif font-bold text-foreground mb-6 flex items-center gap-2">
              <i class="fas fa-moon text-primary"></i>
              ‡πÅ‡∏õ‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ù‡∏±‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
            </h3>

            <div class="card">
              <div class="p-6">
                <div class="space-y-4">
                  <div class="bg-muted/50 p-4 rounded-lg">
                    <h4 class="font-semibold mb-2 text-foreground">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ù‡∏±‡∏ô‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°: "‡∏ù‡∏±‡∏ô‡πÄ‡∏´‡πá‡∏ô‡∏á‡∏π‡πÉ‡∏´‡∏ç‡πà‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß"</h4>
                    <p class="text-sm text-muted-foreground mb-3">
                      ‡∏á‡∏π‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÉ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ù‡∏±‡∏ô‡πÅ‡∏ó‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ‡πÅ‡∏•‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏≠‡∏á ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏•‡∏Ç 89, 98, 08
                    </p>
                    <div class="flex gap-2">
                      <span class="badge badge-outline">89</span>
                      <span class="badge badge-outline">98</span>
                      <span class="badge badge-outline">08</span>
                    </div>
                  </div>

                  <div class="space-y-3">
                    <textarea 
                      id="dreamInput"
                      placeholder="‡πÄ‡∏•‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ù‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..." 
                      rows="3" 
                      class="textarea resize-none"
                    ></textarea>
                    <button onclick="interpretDream()" id="dreamBtn" class="btn btn-primary w-full">
                      <i class="fas fa-moon mr-2"></i>
                      ‡πÅ‡∏õ‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ù‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
                    </button>
                  </div>

                  <!-- Loading -->
                  <div id="dreamLoading" class="hidden text-center py-4">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
                    <p class="mt-2 text-muted-foreground">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ù‡∏±‡∏ô...</p>
                  </div>
                  
                  <!-- Results -->
                  <div id="dreamResults" class="hidden">
                    <div class="bg-primary/10 rounded-lg p-4 mb-4">
                      <h4 class="font-semibold text-primary mb-2">‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢:</h4>
                      <p id="dreamInterpretation" class="text-foreground"></p>
                    </div>
                    
                    <div class="bg-muted/50 rounded-lg p-4 mb-4">
                      <h4 class="font-semibold text-foreground mb-3">‡πÄ‡∏•‡∏Ç‡∏°‡∏á‡∏Ñ‡∏•‡∏à‡∏≤‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ù‡∏±‡∏ô:</h4>
                      <div id="dreamNumbers" class="grid grid-cols-3 gap-3"></div>
                    </div>
                    
                    <button onclick="resetDreamForm()" class="btn btn-outline w-full">
                      ‡∏ï‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Sidebar -->
        <div class="space-y-6">
          <!-- Quick Lottery Check -->
          <div class="card">
            <div class="p-4 border-b">
              <h3 class="font-serif flex items-center gap-2 text-lg font-bold text-foreground">
                <i class="fas fa-search text-primary"></i>
                ‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏ß‡∏¢‡∏î‡πà‡∏ß‡∏ô
              </h3>
            </div>
            <div class="p-4 space-y-3">
              <input 
                id="lotteryInput"
                placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç 6 ‡∏´‡∏•‡∏±‡∏Å" 
                class="input"
                maxlength="6"
                pattern="[0-9]{6}"
              />
              <button onclick="checkLottery()" id="lotteryBtn" class="btn btn-primary w-full">‡∏ï‡∏£‡∏ß‡∏à‡∏ú‡∏•‡∏´‡∏ß‡∏¢</button>
              <a href="/lottery_checker/" class="btn btn-outline w-full">
                <i class="fas fa-search mr-2"></i>
                ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏ß‡∏¢‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
              </a>
              {% if latest_lottery_result %}
              <div class="text-xs text-muted-foreground text-center">‡∏á‡∏ß‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: {{ latest_lottery_result.formatted_date }}</div>
              {% endif %}

              <!-- Loading -->
              <div id="lotteryLoading" class="hidden text-center py-4">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
                <p class="mt-2 text-muted-foreground">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</p>
              </div>
              
              <!-- Results -->
              <div id="lotteryResults" class="hidden">
                <div class="bg-primary/10 rounded-lg p-4 mb-4">
                  <h4 class="font-semibold text-primary mb-2">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:</h4>
                  <div id="lotteryResultText" class="text-foreground"></div>
                </div>
                
                <button onclick="resetLotteryForm()" class="btn btn-outline w-full">
                  ‡∏ï‡∏£‡∏ß‡∏à‡πÉ‡∏´‡∏°‡πà
                </button>
              </div>
            </div>
          </div>

          <!-- Hot Numbers -->
          <div class="card">
            <div class="p-4 border-b">
              <h3 class="font-serif flex items-center gap-2 text-lg font-bold text-foreground">
                <i class="fas fa-chart-bar text-secondary"></i>
                ‡πÄ‡∏•‡∏Ç‡∏Æ‡∏¥‡∏ï‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå
              </h3>
            </div>
            <div class="p-4">
              <div class="space-y-3">
                <div class="flex justify-between items-center">
                  <span class="text-sm text-foreground">‡πÄ‡∏•‡∏Ç‡∏≠‡∏≠‡∏Å‡∏ö‡πà‡∏≠‡∏¢</span>
                  <div class="flex gap-1">
                    <span class="badge badge-secondary">07</span>
                    <span class="badge badge-secondary">23</span>
                    <span class="badge badge-secondary">45</span>
                  </div>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm text-foreground">‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏≠‡∏≠‡∏Å</span>
                  <div class="flex gap-1">
                    <span class="badge badge-outline">89</span>
                    <span class="badge badge-outline">91</span>
                    <span class="badge badge-outline">96</span>
                  </div>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm text-foreground">‡πÄ‡∏•‡∏Ç‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏™‡∏π‡∏á</span>
                  <div class="flex gap-1">
                    <span class="badge bg-accent text-accent-foreground">12</span>
                    <span class="badge bg-accent text-accent-foreground">34</span>
                    <span class="badge bg-accent text-accent-foreground">56</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- AI Prediction -->
          <div class="card border-primary/20">
            <div class="p-4 border-b">
              <h3 class="font-serif flex items-center gap-2 text-lg font-bold text-foreground">
                <i class="fas fa-brain text-primary"></i>
                AI ‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà
              </h3>
            </div>
            <div class="p-4">
              <div class="text-center space-y-4">
                <div>
                  {% if latest_prediction %}
                    <div class="text-2xl font-bold text-primary mb-1">{{ latest_prediction.get_three_digit_list.0|default:"427" }}</div>
                    <div class="text-sm text-muted-foreground">‡πÄ‡∏•‡∏Ç‡∏ö‡∏ô 3 ‡∏ï‡∏±‡∏ß</div>
                    <div class="badge bg-primary/10 text-primary mt-2">{{ latest_prediction.overall_confidence|floatformat:0|default:"87" }}% ‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥</div>
                  {% else %}
                    <div class="text-2xl font-bold text-primary mb-1">427</div>
                    <div class="text-sm text-muted-foreground">‡πÄ‡∏•‡∏Ç‡∏ö‡∏ô 3 ‡∏ï‡∏±‡∏ß</div>
                    <div class="badge bg-primary/10 text-primary mt-2">87% ‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥</div>
                  {% endif %}
                </div>
                <a href="/ai/" class="btn btn-primary w-full">
                  <i class="fas fa-bolt mr-2"></i>
                  ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏•‡∏Ç‡πÉ‡∏´‡∏°‡πà
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>


<script>
// Dream Interpretation Functions
async function interpretDream() {
    const dreamInput = document.getElementById('dreamInput');
    const dreamBtn = document.getElementById('dreamBtn');
    const dreamLoading = document.getElementById('dreamLoading');
    const dreamResults = document.getElementById('dreamResults');
    
    const dreamText = dreamInput.value.trim();
    
    if (!dreamText) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ù‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì');
        return;
    }
    
    // Show loading
    dreamLoading.classList.remove('hidden');
    dreamBtn.disabled = true;
    dreamResults.classList.add('hidden');
    
    try {
        const response = await fetch('/dreams/analyze/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify({
                dream_text: dreamText
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            // Show results
            document.getElementById('dreamInterpretation').textContent = data.result.interpretation;
            
            // Show numbers
            const numbersContainer = document.getElementById('dreamNumbers');
            numbersContainer.innerHTML = '';
            
            data.result.numbers.forEach(number => {
                const div = document.createElement('div');
                div.className = 'bg-card border border-border rounded-lg p-3 text-center';
                div.innerHTML = `<span class="text-xl font-bold text-primary">${number}</span>`;
                numbersContainer.appendChild(div);
            });
            
            dreamResults.classList.remove('hidden');
        } else {
            alert(data.error || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
        }
    } catch (error) {
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
    } finally {
        dreamLoading.classList.add('hidden');
        dreamBtn.disabled = false;
    }
}

function resetDreamForm() {
    document.getElementById('dreamInput').value = '';
    document.getElementById('dreamResults').classList.add('hidden');
    document.getElementById('dreamLoading').classList.add('hidden');
    document.getElementById('dreamBtn').disabled = false;
}

// Lottery Checker Functions
async function checkLottery() {
    const lotteryInput = document.getElementById('lotteryInput');
    const lotteryBtn = document.getElementById('lotteryBtn');
    const lotteryLoading = document.getElementById('lotteryLoading');
    const lotteryResults = document.getElementById('lotteryResults');
    const lotteryResultText = document.getElementById('lotteryResultText');

    const lotteryNumber = lotteryInput.value.trim();

    if (!lotteryNumber) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏™‡∏•‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à');
        return;
    }

    if (!/^\d{6}$/.test(lotteryNumber)) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç 6 ‡∏´‡∏•‡∏±‡∏Å');
        return;
    }

    // Show loading
    lotteryLoading.classList.remove('hidden');
    lotteryBtn.disabled = true;
    lotteryResults.classList.add('hidden');
    lotteryResultText.textContent = ''; // Clear previous results

    try {
        const response = await fetch('/lottery_checker/api/check/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify({
                lottery_number: lotteryNumber
            })
        });

        const data = await response.json();

        if (data.success) {
            // Show results with color coding
            const resultDiv = document.createElement('div');
            if (data.result.is_winner) {
                resultDiv.innerHTML = `
                    <div class="text-green-600 font-bold mb-2">üéâ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢!</div>
                    <div class="text-foreground">${data.result.message}</div>
                `;
                resultDiv.className = 'p-3 bg-green-50 border border-green-200 rounded-lg';
            } else {
                resultDiv.innerHTML = `
                    <div class="text-orange-600 font-bold mb-2">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</div>
                    <div class="text-foreground">${data.result.message}</div>
                `;
                resultDiv.className = 'p-3 bg-orange-50 border border-orange-200 rounded-lg';
            }
            
            lotteryResultText.innerHTML = '';
            lotteryResultText.appendChild(resultDiv);
            lotteryResults.classList.remove('hidden');
        } else {
            lotteryResultText.innerHTML = `
                <div class="p-3 bg-red-50 border border-red-200 rounded-lg">
                    <div class="text-red-600 font-bold mb-2">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</div>
                    <div class="text-foreground">${data.error || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà'}</div>
                </div>
            `;
            lotteryResults.classList.remove('hidden');
        }
    } catch (error) {
        lotteryResultText.innerHTML = `
            <div class="p-3 bg-red-50 border border-red-200 rounded-lg">
                <div class="text-red-600 font-bold mb-2">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</div>
                <div class="text-foreground">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ</div>
            </div>
        `;
        lotteryResults.classList.remove('hidden');
    } finally {
        lotteryLoading.classList.add('hidden');
        lotteryBtn.disabled = false;
    }
}

function resetLotteryForm() {
    document.getElementById('lotteryInput').value = '';
    document.getElementById('lotteryResults').classList.add('hidden');
    document.getElementById('lotteryLoading').classList.add('hidden');
    document.getElementById('lotteryResultText').textContent = '';
    document.getElementById('lotteryBtn').disabled = false;
}

// Utility function to get CSRF token
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Enter key support for inputs
document.addEventListener('DOMContentLoaded', function() {
    const dreamInput = document.getElementById('dreamInput');
    if (dreamInput) {
        dreamInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                interpretDream();
            }
        });
    }
    
    const lotteryInput = document.getElementById('lotteryInput');
    if (lotteryInput) {
        lotteryInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkLottery();
            }
        });
    }
});
</script>

{% block extra_js %}
<script src="{% static 'js/theme.js' %}"></script>
{% endblock %}
{% endblock %}