# ไทยรัฐ News Scraper

สคริปต์สำหรับดึงข่าวจากเว็บไซต์ไทยรัฐและบันทึกลงฐานข้อมูล Django

## ไฟล์ที่สร้างขึ้น

1. **`simple_thairath_test.py`** - สคริปต์ทดลองง่ายๆ
2. **`test_thairath_scraper.py`** - สคริปต์ทดลองแบบเต็มรูปแบบ
3. **`app/news/management/commands/scrape_thairath.py`** - Django management command

## การใช้งาน

### 1. ทดลองรันสคริปต์ง่ายๆ

```bash
python simple_thairath_test.py
```

### 2. ใช้ Django Management Command

```bash
# ดึงข่าว 10 ข่าวแรก (ไม่บันทึกลงฐานข้อมูล)
python manage.py scrape_thairath

# ดึงข่าว 20 ข่าวและบันทึกลงฐานข้อมูล
python manage.py scrape_thairath --limit 20 --save

# ดึงข่าวจาก URL อื่น
python manage.py scrape_thairiter --url "https://www.thairath.co.th/news/crime" --save

# กำหนดหมวดหมู่
python manage.py scrape_thairath --save --category "ข่าวอาชญากรรม"
```

### 3. ตัวเลือกทั้งหมด

- `--url`: URL ของหน้าเว็บไทยรัฐ (ค่าเริ่มต้น: ข่าวทั่วไทยล่าสุด)
- `--limit`: จำนวนข่าวสูงสุดที่ต้องการดึง (ค่าเริ่มต้น: 10)
- `--save`: บันทึกข่าวลงฐานข้อมูล
- `--category`: หมวดหมู่ข่าวที่จะบันทึก (ค่าเริ่มต้น: ข่าวทั่วไป)

## ฟีเจอร์

### การดึงข้อมูล
- ดึงหัวข้อข่าวจากหน้าเว็บไทยรัฐ
- แยกเลข 2-3 หลักจากหัวข้อข่าว
- สร้าง URL เต็มสำหรับแต่ละข่าว
- ตรวจสอบข่าวซ้ำ

### การวิเคราะห์เลข
- หาเลข 2-3 หลักจากหัวข้อข่าว
- แยกเลข 3 หลักเป็นเลข 2 หลัก
- ลบเลขซ้ำและจำกัดจำนวน

### การบันทึกข้อมูล
- สร้างหมวดหมู่ข่าวอัตโนมัติ
- บันทึกข่าวลงฐานข้อมูล Django
- สร้าง slug จากหัวข้อข่าว
- กำหนดสถานะเป็น "เผยแพร่"

## โครงสร้างข้อมูลที่ได้

```json
{
  "title": "หัวข้อข่าว",
  "url": "https://www.thairath.co.th/news/...",
  "numbers": ["12", "34", "56"],
  "source": "thairath",
  "scraped_at": "2024-01-01T12:00:00"
}
```

## การติดตั้ง

1. ตรวจสอบว่ามีไลบรารีที่จำเป็นแล้ว:
   - `requests`
   - `beautifulsoup4`
   - `lxml`

2. รัน migration เพื่อเพิ่มฟิลด์ `source_url`:
   ```bash
   python manage.py makemigrations
   python manage.py migrate
   ```

## หมายเหตุ

- สคริปต์ใช้ User-Agent เพื่อจำลอง browser
- มีการจัดการ timeout และ error handling
- ผลลัพธ์จะถูกบันทึกเป็นไฟล์ JSON ด้วย
- ตรวจสอบข่าวซ้ำก่อนบันทึกลงฐานข้อมูล

## การแก้ไขปัญหา

### ถ้าไม่สามารถดึงข้อมูลได้
1. ตรวจสอบการเชื่อมต่ออินเทอร์เน็ต
2. ลองเปลี่ยน User-Agent
3. ตรวจสอบว่าเว็บไซต์ไม่มีการป้องกัน bot

### ถ้าไม่พบข่าว
1. ตรวจสอบ CSS selector ที่ใช้
2. ลองดูโครงสร้าง HTML ของเว็บไซต์
3. ปรับ selector ให้เหมาะสม

## การพัฒนาต่อ

- เพิ่มการดึงเนื้อหาข่าวเต็ม
- เพิ่มการวิเคราะห์เลขจากเนื้อหา
- เพิ่มการดึงรูปภาพ
- เพิ่มการดึงข้อมูลเพิ่มเติม (วันที่, ผู้เขียน)
- เพิ่มการดึงข่าวจากแหล่งอื่นๆ
