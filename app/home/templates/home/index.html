{% extends "base.html" %}
{% load static %}

{% block title %}‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡πá‡∏î AI ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô - ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ß‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏•‡∏Ç‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ{% endblock %}

{% block extra_css %}{% endblock %}

{% block content %}

  <!-- Daily Lucky Numbers Section - New Design -->
  <section class="py-16 bg-gradient-to-br from-primary/10 via-accent/5 to-secondary/10 relative overflow-hidden border-b-2 border-primary/20">
    <!-- Background Effects -->
    <div class="absolute inset-0" style="background: radial-gradient(circle at 70% 30%, rgba(255, 193, 7, 0.15), transparent 60%);"></div>
    <div class="absolute top-0 right-0 w-64 h-64 bg-gradient-to-bl from-primary/20 to-transparent rounded-full -translate-y-32 translate-x-32"></div>
    
    <div class="container mx-auto px-4 relative z-10">
      <div class="max-w-6xl mx-auto">
        <!-- Main Header -->
        <div class="text-center mb-12">
          <div class="inline-flex items-center gap-2 px-4 py-2 bg-primary/20 rounded-full text-primary font-semibold mb-4">
            <i class="fas fa-sun"></i>
            <span>DAILY LUCKY NUMBERS</span>
            <i class="fas fa-sparkles"></i>
          </div>
          
          <h1 class="text-4xl md:text-6xl font-serif font-bold text-foreground mb-4 leading-tight">
            <span class="text-primary">‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡πá‡∏î AI ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</span>
          </h1>
          
          <p class="text-xl text-muted-foreground mb-2">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ß‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏•‡∏Ç‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ</p>
          <p class="text-base text-muted-foreground">‡∏á‡∏ß‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà {{ target_lottery_date }}</p>
          
          <div class="mt-4 inline-flex items-center gap-2 px-4 py-2 bg-accent/20 rounded-full text-accent text-sm">
            <i class="fas fa-clock"></i>
            ‡πÄ‡∏•‡∏Ç‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô ‡πÄ‡∏ß‡∏•‡∏≤ 9:00
          </div>
        </div>

        <!-- Daily Numbers Section - Full Width -->
        <div class="max-w-4xl mx-auto mb-10">
          <div class="card border-2 border-amber-300/50 bg-gradient-to-br from-amber-50 to-yellow-50 hover:shadow-xl transition-all duration-300">
            <div class="p-12 text-center">
              <div class="w-20 h-20 bg-gradient-to-br from-amber-400 to-yellow-500 rounded-full flex items-center justify-center mx-auto mb-6">
                <i class="fas fa-sun text-3xl text-white"></i>
              </div>
              <h3 class="text-3xl font-bold text-foreground mb-4">üåÖ ‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡πá‡∏î‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</h3>
              <p class="text-lg text-muted-foreground mb-8">‡∏à‡∏≤‡∏Å‡∏Ç‡πà‡∏≤‡∏ß‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</p>
              <div class="flex justify-center gap-4 flex-wrap mb-8">
                {% for number in morning_news_numbers %}
                <div class="w-20 h-20 bg-gradient-to-br from-amber-500 to-yellow-600 text-white rounded-xl flex items-center justify-center font-bold text-2xl shadow-xl hover:scale-110 transition-transform">
                  {{ number }}
                </div>
                {% empty %}
                <div class="text-muted-foreground text-lg">
                  <i class="fas fa-newspaper mr-2"></i>
                  ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πà‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡πá‡∏î‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ô‡∏µ‡πâ
                </div>
                {% endfor %}
              </div>
              <p class="text-base text-muted-foreground">üìÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô 9:00 ‡∏ô. ‚Ä¢ ‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏ï‡∏•‡∏≠‡∏î‡∏ß‡∏±‡∏ô</p>
            </div>
          </div>
        </div>

        <!-- News Source Analysis -->
        <div class="card bg-gradient-to-r from-amber-500/10 to-orange-500/10 border border-amber-300/20 mb-8">
          <div class="p-6">
            <div class="flex items-start gap-4">
              <div class="w-12 h-12 bg-amber-500 rounded-full flex items-center justify-center flex-shrink-0">
                <i class="fas fa-newspaper text-white"></i>
              </div>
              <div class="flex-1">
                <h4 class="text-lg font-semibold text-foreground mb-3">‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πà‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡∏°‡∏≤‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</h4>
                <div class="space-y-3">
                  {% for article in daily_news_sources %}
                  <div class="flex items-start gap-3 p-3 bg-amber-50 rounded-lg border border-amber-200">
                    <div class="w-8 h-8 bg-amber-500 text-white rounded-full flex items-center justify-center flex-shrink-0 text-sm font-bold">
                      {{ forloop.counter }}
                    </div>
                    <div class="flex-1">
                      <h5 class="font-medium text-foreground text-sm mb-1">{{ article.title|truncatechars:80 }}</h5>
                      <div class="flex items-center gap-4 text-xs text-amber-700">
                        <span class="flex items-center gap-1">
                          <i class="fas fa-clock"></i>
                          {{ article.published_date|timesince }}‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß
                        </span>
                        <span class="flex items-center gap-1">
                          <i class="fas fa-tags"></i>
                          {{ article.category.name|default:"‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ" }}
                        </span>
                        {% if article.lottery_relevance_score %}
                        <span class="flex items-center gap-1">
                          <i class="fas fa-star"></i>
                          ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô {{ article.lottery_relevance_score }}
                        </span>
                        {% endif %}
                      </div>
                      {% if article.get_extracted_numbers_list %}
                      <div class="mt-2 flex gap-1">
                        <span class="text-xs text-amber-600 mr-1">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ:</span>
                        {% for number in article.get_extracted_numbers_list|slice:":3" %}
                        <span class="px-2 py-1 bg-amber-500 text-white rounded text-xs font-mono">{{ number }}</span>
                        {% endfor %}
                      </div>
                      {% endif %}
                    </div>
                  </div>
                  {% empty %}
                  <div class="text-center py-4 text-muted-foreground">
                    <i class="fas fa-info-circle mr-2"></i>
                    ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πà‡∏≤‡∏ß‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏µ‡πâ
                  </div>
                  {% endfor %}
                </div>
                
                {% if daily_news_sources %}
                <div class="mt-4 pt-3 border-t border-amber-200">
                  <div class="text-sm text-amber-700 flex items-center justify-between">
                    <span>
                      <i class="fas fa-chart-bar mr-1"></i>
                      ‡∏£‡∏ß‡∏° {{ daily_news_sources|length }} ‡∏Ç‡πà‡∏≤‡∏ß ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏Ç {{ morning_news_numbers|length }} ‡∏ï‡∏±‡∏ß
                    </span>
                    <span class="text-xs">
                      <i class="fas fa-sync mr-1"></i>
                      ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: {{ current_date|date:"H:i" }} ‡∏ô.
                    </span>
                  </div>
                </div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>

        <!-- Call-to-Action -->
        <div class="text-center">
          <a href="{% url 'ai_engine:prediction' %}" 
             class="inline-flex items-center gap-3 px-8 py-4 bg-gradient-to-r from-primary to-secondary text-white font-bold text-lg rounded-xl hover:shadow-xl transform hover:scale-105 transition-all duration-300">
            <i class="fas fa-chart-line"></i>
            <span>‡∏î‡∏π‡∏ö‡∏ó‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå AI ‡∏â‡∏ö‡∏±‡∏ö‡πÄ‡∏ï‡πá‡∏°</span>
            <i class="fas fa-arrow-right"></i>
          </a>
          <p class="text-sm text-muted-foreground mt-3">
            ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏≤‡∏Å 3 ‡πÇ‡∏°‡πÄ‡∏î‡∏• AI ‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏Ç‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Next Draw Prediction Section -->
  <section class="py-16 bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-100 relative overflow-hidden border-b-2 border-blue/20">
    <!-- Background Effects -->
    <div class="absolute inset-0" style="background: radial-gradient(circle at 30% 70%, rgba(59, 130, 246, 0.15), transparent 60%);"></div>
    <div class="absolute top-0 left-0 w-64 h-64 bg-gradient-to-br from-blue-500/20 to-transparent rounded-full -translate-y-32 -translate-x-32"></div>
    
    <div class="container mx-auto px-4 relative z-10">
      <div class="max-w-6xl mx-auto">
        <!-- Main Header -->
        <div class="text-center mb-12">
          <div class="inline-flex items-center gap-2 px-4 py-2 bg-blue-500/20 rounded-full text-blue-700 font-semibold mb-4">
            <i class="fas fa-chart-line"></i>
            <span>NEXT DRAW PREDICTION</span>
            <i class="fas fa-crystal-ball"></i>
          </div>
          
          <h2 class="text-4xl md:text-6xl font-serif font-bold text-foreground mb-4 leading-tight">
            <span class="text-blue-600">üéØ ‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡πá‡∏î‡∏´‡∏ß‡∏¢‡∏á‡∏ß‡∏î‡∏´‡∏ô‡πâ‡∏≤</span>
          </h2>
          
          <p class="text-xl text-muted-foreground mb-2">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏≤‡∏Å‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏Ç‡πà‡∏≤‡∏ß‡πÉ‡∏´‡∏ç‡πà</p>
          <p class="text-base text-muted-foreground">{{ next_draw_prediction.data_source_summary|default:"‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏≤‡∏Å‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î + ‡∏Ç‡πà‡∏≤‡∏ß‡πÉ‡∏´‡∏ç‡πà‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏á‡∏ß‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß" }}</p>
          
          <div class="mt-4 inline-flex items-center gap-2 px-4 py-2 bg-indigo-500/20 rounded-full text-indigo-700 text-sm">
            <i class="fas fa-sync"></i>
            ‡πÄ‡∏•‡∏Ç‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡πà‡∏≤‡∏ß‡πÉ‡∏´‡∏°‡πà
          </div>
        </div>

        <!-- Prediction Numbers Display -->
        <div class="grid md:grid-cols-2 gap-8 mb-10">
          
          <!-- Main Numbers -->
          <div class="card border-2 border-blue-300/50 bg-gradient-to-br from-blue-50 to-indigo-50 hover:shadow-xl transition-all duration-300">
            <div class="p-8 text-center">
              <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-chart-bar text-2xl text-white"></i>
              </div>
              <h3 class="text-xl font-bold text-foreground mb-2">üìä ‡∏à‡∏≤‡∏Å‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</h3>
              <p class="text-sm text-muted-foreground mb-4">‡πÄ‡∏•‡∏Ç‡∏Æ‡∏≠‡∏ï ‡πÄ‡∏•‡∏Ç‡πÄ‡∏¢‡πá‡∏ô ‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏Ç‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°</p>
              <div class="flex justify-center gap-3 flex-wrap mb-4">
                {% for item in next_draw_prediction.prediction_numbers %}
                  {% if item.source == 'hot_stats' or item.source == 'cold_stats' %}
                  <div class="relative group">
                    <div class="w-14 h-14 bg-gradient-to-br from-blue-500 to-indigo-600 text-white rounded-lg flex items-center justify-center font-bold text-lg shadow-lg hover:scale-110 transition-transform"
                         title="{{ item.reason }}">
                      {{ item.number }}
                    </div>
                    <div class="absolute -top-2 -right-2 w-6 h-6 bg-yellow-500 text-white rounded-full flex items-center justify-center text-xs font-bold">
                      {{ item.confidence|floatformat:0 }}
                    </div>
                  </div>
                  {% endif %}
                {% empty %}
                <div class="w-14 h-14 bg-gradient-to-br from-blue-500 to-indigo-600 text-white rounded-lg flex items-center justify-center font-bold text-lg shadow-lg">47</div>
                <div class="w-14 h-14 bg-gradient-to-br from-blue-500 to-indigo-600 text-white rounded-lg flex items-center justify-center font-bold text-lg shadow-lg">23</div>
                <div class="w-14 h-14 bg-gradient-to-br from-blue-500 to-indigo-600 text-white rounded-lg flex items-center justify-center font-bold text-lg shadow-lg">89</div>
                {% endfor %}
              </div>
              <p class="text-xs text-muted-foreground">üî¢ ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏á‡∏ß‡∏î‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤</p>
            </div>
          </div>
          
          <!-- News-based Numbers -->
          <div class="card border-2 border-purple-300/50 bg-gradient-to-br from-purple-50 to-pink-50 hover:shadow-xl transition-all duration-300">
            <div class="p-8 text-center">
              <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-newspaper text-2xl text-white"></i>
              </div>
              <h3 class="text-xl font-bold text-foreground mb-2">üì∞ ‡∏à‡∏≤‡∏Å‡∏Ç‡πà‡∏≤‡∏ß‡πÉ‡∏´‡∏ç‡πà</h3>
              <p class="text-sm text-muted-foreground mb-4">‡∏Ç‡πà‡∏≤‡∏ß‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á ‚â•80 ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏á‡∏ß‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</p>
              <div class="flex justify-center gap-3 flex-wrap mb-4">
                {% for item in next_draw_prediction.prediction_numbers %}
                  {% if item.source == 'major_news' %}
                  <div class="relative group">
                    <div class="w-14 h-14 bg-gradient-to-br from-purple-500 to-pink-600 text-white rounded-lg flex items-center justify-center font-bold text-lg shadow-lg hover:scale-110 transition-transform"
                         title="{{ item.reason }}">
                      {{ item.number }}
                    </div>
                    <div class="absolute -top-2 -right-2 w-6 h-6 bg-orange-500 text-white rounded-full flex items-center justify-center text-xs font-bold">
                      {{ item.confidence|floatformat:0 }}
                    </div>
                  </div>
                  {% endif %}
                {% empty %}
                <div class="w-14 h-14 bg-gradient-to-br from-purple-500 to-pink-600 text-white rounded-lg flex items-center justify-center font-bold text-lg shadow-lg">15</div>
                <div class="w-14 h-14 bg-gradient-to-br from-purple-500 to-pink-600 text-white rounded-lg flex items-center justify-center font-bold text-lg shadow-lg">72</div>
                <div class="w-14 h-14 bg-gradient-to-br from-purple-500 to-pink-600 text-white rounded-lg flex items-center justify-center font-bold text-lg shadow-lg">34</div>
                {% endfor %}
              </div>
              <p class="text-xs text-muted-foreground">üìà ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏≤‡∏Å {{ next_draw_prediction.total_news_analyzed|default:"5" }} ‡∏Ç‡πà‡∏≤‡∏ß‡πÉ‡∏´‡∏ç‡πà</p>
            </div>
          </div>
          
        </div>

        <!-- Combined Top Predictions -->
        <div class="card bg-gradient-to-r from-blue-500/10 via-indigo-500/10 to-purple-500/10 border-2 border-indigo-300/50 mb-8">
          <div class="p-8 text-center">
            <h3 class="text-2xl font-bold text-foreground mb-4">üèÜ ‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡πá‡∏î‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</h3>
            <p class="text-muted-foreground mb-6">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏Ç‡πà‡∏≤‡∏ß ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠</p>
            <div class="flex justify-center gap-4 flex-wrap">
              {% for number in next_draw_numbers|slice:":6" %}
              <div class="w-20 h-20 bg-gradient-to-br from-indigo-600 to-purple-700 text-white rounded-xl flex items-center justify-center font-bold text-2xl shadow-xl hover:scale-110 transition-all duration-300">
                {{ number }}
              </div>
              {% empty %}
              <div class="w-20 h-20 bg-gradient-to-br from-indigo-600 to-purple-700 text-white rounded-xl flex items-center justify-center font-bold text-2xl shadow-xl">47</div>
              <div class="w-20 h-20 bg-gradient-to-br from-indigo-600 to-purple-700 text-white rounded-xl flex items-center justify-center font-bold text-2xl shadow-xl">23</div>
              <div class="w-20 h-20 bg-gradient-to-br from-indigo-600 to-purple-700 text-white rounded-xl flex items-center justify-center font-bold text-2xl shadow-xl">89</div>
              <div class="w-20 h-20 bg-gradient-to-br from-indigo-600 to-purple-700 text-white rounded-xl flex items-center justify-center font-bold text-2xl shadow-xl">15</div>
              <div class="w-20 h-20 bg-gradient-to-br from-indigo-600 to-purple-700 text-white rounded-xl flex items-center justify-center font-bold text-2xl shadow-xl">72</div>
              <div class="w-20 h-20 bg-gradient-to-br from-indigo-600 to-purple-700 text-white rounded-xl flex items-center justify-center font-bold text-2xl shadow-xl">34</div>
              {% endfor %}
            </div>
          </div>
        </div>

        <!-- Analysis Summary -->
        <div class="card bg-gradient-to-r from-indigo-500/10 to-purple-500/10 border border-indigo-300/20">
          <div class="p-6">
            <div class="flex items-start gap-4">
              <div class="w-12 h-12 bg-indigo-500 rounded-full flex items-center justify-center flex-shrink-0">
                <i class="fas fa-analytics text-white"></i>
              </div>
              <div class="flex-1">
                <h4 class="text-lg font-semibold text-foreground mb-2">‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</h4>
                <div class="grid md:grid-cols-2 gap-4 text-sm text-foreground">
                  <div>
                    <span class="font-medium">üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥:</span> {{ next_draw_prediction.statistical_coverage|default:"10" }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£<br>
                    <span class="font-medium">üì∞ ‡∏Ç‡πà‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:</span> {{ next_draw_prediction.total_news_analyzed|default:"5" }} ‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°<br>
                    <span class="font-medium">üìÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà:</span> {{ next_draw_prediction.last_draw_date|date:"d/m/Y"|default:"20/08/2025" }}
                  </div>
                  <div>
                    <span class="font-medium">üéØ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£:</span> ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ Hot/Cold + ‡∏Ç‡πà‡∏≤‡∏ß‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á<br>
                    <span class="font-medium">üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï:</span> ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡πà‡∏≤‡∏ß‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥<br>
                    <span class="font-medium">‚ö° ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</span> <span class="text-green-600 font-semibold">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Call-to-Action -->
        <div class="text-center mt-8">
          <a href="{% url 'lotto_stats:statistics' %}" 
             class="inline-flex items-center gap-3 px-8 py-4 bg-gradient-to-r from-blue-600 to-indigo-700 text-white font-bold text-lg rounded-xl hover:shadow-xl transform hover:scale-105 transition-all duration-300 mr-4">
            <i class="fas fa-chart-bar"></i>
            <span>‡∏î‡∏π‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÇ‡∏î‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</span>
            <i class="fas fa-arrow-right"></i>
          </a>
          <a href="/news/?category=major" 
             class="inline-flex items-center gap-3 px-8 py-4 bg-gradient-to-r from-purple-600 to-pink-700 text-white font-bold text-lg rounded-xl hover:shadow-xl transform hover:scale-105 transition-all duration-300">
            <i class="fas fa-newspaper"></i>
            <span>‡∏î‡∏π‡∏Ç‡πà‡∏≤‡∏ß‡πÉ‡∏´‡∏ç‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
            <i class="fas fa-external-link-alt"></i>
          </a>
          <p class="text-sm text-muted-foreground mt-3">
            ‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡∏ú‡∏™‡∏°‡∏ú‡∏™‡∏≤‡∏ô‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πà‡∏≤‡∏ß
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Instant Lucky Numbers Section -->
  <section id="instantLuckyNumbers" class="py-16 bg-gradient-to-br from-green-50 to-emerald-100 border-y border-green-200">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-12">
          <div class="inline-flex items-center gap-2 px-4 py-2 bg-green-500/20 rounded-full text-green-700 font-semibold mb-4">
            <i class="fas fa-bolt"></i>
            <span>INSTANT LUCKY</span>
            <i class="fas fa-sparkles"></i>
          </div>
          
          <h2 class="text-4xl md:text-5xl font-serif font-bold text-green-800 mb-4">
            üéØ ‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡πá‡∏î‡∏ó‡∏±‡∏ô‡πÉ‡∏à
          </h2>
          
          <p class="text-lg text-green-700 mb-2">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡πá‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏î‡πÜ</p>
          <p class="text-base text-green-600">‡∏£‡∏ß‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î + ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
        </div>

        <!-- Input Section -->
        <div class="bg-white rounded-2xl shadow-lg p-8 mb-8 border border-green-200">
          <div class="max-w-2xl mx-auto">
            <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">
              üí´ ‡πÉ‡∏™‡πà‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ)
            </h3>
            
            <div class="space-y-4">
              <!-- Date Selection -->
              <div class="flex flex-col md:flex-row gap-4 items-center justify-center">
                <div class="w-full md:w-auto">
                  <input 
                    type="date" 
                    id="significantDate"
                    class="w-full px-4 py-3 border-2 border-green-300 rounded-lg focus:border-green-500 focus:outline-none text-center text-lg"
                    placeholder="‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î, ‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏ö‡∏£‡∏≠‡∏ö ‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç"
                  >
                  <p class="text-sm text-gray-500 mt-1 text-center">‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏ = ‡∏ß‡∏±‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</p>
                </div>
                
                <button 
                  id="generateBtn"
                  class="w-full md:w-auto px-8 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold text-lg rounded-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 flex items-center justify-center gap-2"
                >
                  <i class="fas fa-magic"></i>
                  <span>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡πá‡∏î</span>
                </button>
              </div>

              <!-- News Selection -->
              <div class="border-t border-gray-200 pt-4">
                <h4 class="text-lg font-semibold text-gray-800 mb-3 text-center">
                  üì∞ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πà‡∏≤‡∏ß‡πÄ‡∏â‡∏û‡∏≤‡∏∞ (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ)
                </h4>
                
                <div class="flex items-center justify-center gap-3 mb-3">
                  <button 
                    id="loadNewsBtn"
                    class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors flex items-center gap-2"
                  >
                    <i class="fas fa-newspaper"></i>
                    <span>‡∏î‡∏π‡∏Ç‡πà‡∏≤‡∏ß‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</span>
                  </button>
                  
                  <button 
                    id="clearNewsBtn" 
                    class="px-4 py-2 bg-gray-400 text-white rounded-lg hover:bg-gray-500 transition-colors hidden"
                  >
                    <i class="fas fa-times"></i>
                    <span>‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</span>
                  </button>
                </div>

                <!-- News Loading State -->
                <div id="newsLoadingState" class="hidden text-center py-2">
                  <div class="inline-flex items-center gap-2 text-blue-600">
                    <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"></div>
                    <span class="text-sm">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πà‡∏≤‡∏ß...</span>
                  </div>
                </div>

                <!-- News Selection Area -->
                <div id="newsSelectionArea" class="hidden">
                  <p class="text-sm text-gray-600 mb-3 text-center">
                    ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πà‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å = ‡πÉ‡∏ä‡πâ‡∏Ç‡πà‡∏≤‡∏ß‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)
                  </p>
                  
                  <div id="newsCheckboxList" class="max-h-60 overflow-y-auto space-y-2 bg-gray-50 rounded-lg p-3">
                    <!-- News items will be loaded here -->
                  </div>
                  
                  <div class="mt-3 text-center">
                    <span id="selectedNewsCount" class="text-sm text-green-600 font-medium">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß: 0 ‡∏Ç‡πà‡∏≤‡∏ß</span>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="mt-4 text-center">
              <p class="text-xs text-gray-500 flex items-center justify-center gap-1">
                <i class="fas fa-shield-alt text-green-500"></i>
                ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‚Ä¢ ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‚Ä¢ ‡πÉ‡∏ä‡πâ‡∏ü‡∏£‡∏µ
              </p>
            </div>
          </div>
        </div>

        <!-- Results Section -->
        <div id="instantLuckyResults" class="hidden">
          <div class="bg-white rounded-2xl shadow-xl p-8 border-2 border-green-300">
            <!-- Header -->
            <div class="text-center mb-6">
              <h3 class="text-2xl font-bold text-green-800 mb-2">
                ‚ú® ‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡πá‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
              </h3>
              <p id="resultsSubtitle" class="text-green-600"></p>
            </div>

            <!-- Lucky Numbers Display -->
            <div id="luckyNumbersGrid" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
              <!-- Numbers will be inserted here via JavaScript -->
            </div>

            <!-- Insights -->
            <div id="insights" class="grid md:grid-cols-2 gap-6 mb-6">
              <div class="bg-green-50 rounded-lg p-4 border border-green-200">
                <h4 class="font-semibold text-green-800 mb-2">
                  <i class="fas fa-chart-bar"></i> ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
                </h4>
                <div id="insightStats" class="text-sm text-green-700">
                  <!-- Stats will be inserted here -->
                </div>
              </div>
              
              <div class="bg-emerald-50 rounded-lg p-4 border border-emerald-200">
                <h4 class="font-semibold text-emerald-800 mb-2">
                  <i class="fas fa-lightbulb"></i> ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢
                </h4>
                <div id="thaiMessage" class="text-sm text-emerald-700">
                  <!-- Thai message will be inserted here -->
                </div>
              </div>
            </div>

            <!-- Components Breakdown -->
            <div id="breakdown" class="bg-gray-50 rounded-lg p-4 border border-gray-200">
              <h4 class="font-semibold text-gray-800 mb-3">
                <i class="fas fa-cogs"></i> ‡πÄ‡∏•‡∏Ç‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡πÑ‡∏´‡∏ô
              </h4>
              <div id="numberSources" class="space-y-2">
                <!-- Sources will be inserted here -->
              </div>
            </div>
            
            <!-- Generate Again Button -->
            <div class="text-center mt-6">
              <button 
                id="generateAgainBtn"
                class="px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors"
              >
                <i class="fas fa-redo"></i>
                ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
              </button>
            </div>
          </div>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="hidden text-center py-8">
          <div class="inline-flex items-center gap-3 px-6 py-3 bg-white rounded-lg shadow-lg">
            <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-green-500"></div>
            <span class="text-green-700 font-medium">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡πá‡∏î...</span>
          </div>
        </div>

        <!-- Privacy Notice -->
        <div class="text-center mt-8">
          <div class="inline-flex items-center gap-2 px-4 py-2 bg-white/50 rounded-lg text-green-700 text-sm">
            <i class="fas fa-info-circle"></i>
            <span>‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡πá‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á ‚Ä¢ ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Other Highlights -->
  <section class="py-6 bg-muted/30">
    <div class="container mx-auto px-4">
      <div class="text-center mb-6">
        <h2 class="text-2xl font-serif font-bold text-foreground mb-2">‡πÑ‡∏Æ‡πÑ‡∏•‡∏ó‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</h2>
        <p class="text-muted-foreground">‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡πá‡∏î‡∏à‡∏≤‡∏Å‡πÅ‡∏´‡∏•‡πà‡∏á‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</p>
      </div>

      <!-- Today's Other Numbers -->
      <div class="grid md:grid-cols-3 gap-4 max-w-3xl mx-auto">
        <div class="card border-primary/20 bg-primary/5">
          <div class="p-4 text-center">
            <h3 class="text-sm font-medium text-foreground mb-2">‡πÄ‡∏•‡∏Ç‡∏Æ‡∏¥‡∏ï</h3>
            <div class="text-2xl font-bold text-primary mb-1">42</div>
            <div class="text-xs text-muted-foreground">‡∏à‡∏≤‡∏Å‡∏Ç‡πà‡∏≤‡∏ß</div>
          </div>
        </div>

        <div class="card border-secondary/20 bg-secondary/5">
          <div class="p-4 text-center">
            <h3 class="text-sm font-medium text-foreground mb-2">‡πÄ‡∏•‡∏Ç‡∏Æ‡∏¥‡∏ï</h3>
            <div class="text-2xl font-bold text-secondary mb-1">15</div>
            <div class="text-xs text-muted-foreground">‡∏≠‡∏≠‡∏Å‡∏ö‡πà‡∏≠‡∏¢</div>
          </div>
        </div>

        <div class="card border-accent/20 bg-accent/5">
          <div class="p-4 text-center">
            <h3 class="text-sm font-medium text-foreground mb-2">‡πÄ‡∏•‡∏Ç‡∏ù‡∏±‡∏ô</h3>
            <div class="text-2xl font-bold text-accent mb-1">89</div>
            <div class="text-xs text-muted-foreground">‡∏à‡∏≤‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ù‡∏±‡∏ô</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Daily Stats & Quick Info -->
  <section class="py-8 bg-card/30">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="text-center p-4">
          <div class="text-2xl font-bold text-primary mb-1">{{ site_stats.total_visitors_today|floatformat:0 }}</div>
          <div class="text-sm text-muted-foreground">‡∏Ñ‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ä‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
        </div>
        <div class="text-center p-4">
          <div class="text-2xl font-bold text-secondary mb-1">{{ site_stats.accuracy_percentage }}%</div>
          <div class="text-sm text-muted-foreground">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</div>
        </div>
        <div class="text-center p-4">
          <div class="text-2xl font-bold text-accent mb-1">{{ site_stats.total_predictions }}</div>
          <div class="text-sm text-muted-foreground">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</div>
        </div>
        <div class="text-center p-4">
          <div class="text-2xl font-bold text-primary mb-1">{{ site_stats.total_news_today }}</div>
          <div class="text-sm text-muted-foreground">‡∏Ç‡πà‡∏≤‡∏ß‡πÉ‡∏´‡∏°‡πà‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Main Content Sections -->
  <section class="py-16" id="today">
    <div class="container mx-auto px-4">
      <div class="grid lg:grid-cols-3 gap-8">
        <!-- Left Column - Main Content -->
        <div class="lg:col-span-2 space-y-8">
          <!-- Latest Lottery News -->
          <div>
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-2xl font-serif font-bold text-foreground flex items-center gap-2">
                <i class="fas fa-newspaper text-primary"></i>
                ‡∏Ç‡πà‡∏≤‡∏ß‡∏´‡∏ß‡∏¢‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
              </h3>
              <a href="/news/" class="btn btn-outline">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</a>
            </div>

            <div class="space-y-4">
              {% for article in latest_news %}
              <a href="{{ article.get_absolute_url }}" class="block">
                <div class="card hover:shadow-md transition-shadow">
                  <div class="p-4">
                    <div class="flex gap-4">
                      {% if article.featured_image %}
                        <div class="w-16 h-16 rounded-lg overflow-hidden flex-shrink-0">
                          <img src="{{ article.featured_image.url }}" alt="{{ article.title }}" class="w-full h-full object-cover">
                        </div>
                      {% else %}
                        <div class="w-16 h-16 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0">
                          <i class="fas fa-newspaper text-primary text-2xl"></i>
                        </div>
                      {% endif %}
                      <div class="flex-1">
                        <h4 class="font-semibold mb-2 text-foreground hover:text-primary transition-colors">{{ article.title }}</h4>
                        <p class="text-sm text-muted-foreground mb-2">{{ article.intro|truncatechars:100 }}</p>
                        {% if article.get_extracted_numbers_list %}
                          <div class="flex gap-1 mb-2">
                            {% for number in article.get_extracted_numbers_list|slice:":3" %}
                              <span class="badge badge-outline text-xs">{{ number }}</span>
                            {% endfor %}
                          </div>
                        {% endif %}
                        <div class="flex items-center gap-4 text-xs text-muted-foreground">
                          <span class="flex items-center gap-1">
                            <i class="fas fa-clock"></i>{{ article.published_date|timesince }} ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß
                          </span>
                          <span class="flex items-center gap-1">
                            <i class="fas fa-users"></i>
                            ‡∏≠‡πà‡∏≤‡∏ô {{ article.views }} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </a>
              {% empty %}
              <div class="card hover:shadow-md transition-shadow">
                <div class="p-4">
                  <div class="flex gap-4">
                    <div class="w-16 h-16 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0">
                      <i class="fas fa-newspaper text-primary text-2xl"></i>
                    </div>
                    <div class="flex-1">
                      <h4 class="font-semibold mb-2">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πà‡∏≤‡∏ß‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h4>
                      <p class="text-sm text-muted-foreground mb-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÉ‡∏ô‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á</p>
                    </div>
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>

          <!-- Lottery Locations -->
          <div id="locations">
            <h3 class="text-2xl font-serif font-bold text-foreground mb-6 flex items-center gap-2">
              <i class="fas fa-map-pin text-primary"></i>
              ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡πá‡∏î - ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏´‡∏ß‡∏¢
            </h3>

            <div class="grid md:grid-cols-2 gap-4">
              {% for location in popular_lucky_locations %}
              <a href="{{ location.get_absolute_url }}" class="block">
                <div class="card hover:shadow-md transition-shadow">
                  <div class="p-4">
                    <div class="flex gap-4">
                      {% if location.main_image %}
                        <div class="w-16 h-16 rounded-lg overflow-hidden flex-shrink-0">
                          <img src="{{ location.main_image.url }}" alt="{{ location.name }}" class="w-full h-full object-cover">
                        </div>
                      {% else %}
                        <div class="w-16 h-16 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0">
                          {% if location.category.icon %}
                            <i class="{{ location.category.icon }} text-primary text-xl"></i>
                          {% else %}
                            <i class="fas fa-map-pin text-primary text-xl"></i>
                          {% endif %}
                        </div>
                      {% endif %}
                      <div class="flex-1">
                        <h4 class="font-semibold mb-1 text-foreground hover:text-primary transition-colors">{{ location.name }}</h4>
                        <p class="text-sm text-muted-foreground mb-2">
                          {{ location.province.name }} - {{ location.category.get_name_display }}
                          {% if location.get_lucky_numbers_list %}
                            <br>‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡πà‡∏ô: {{ location.get_lucky_numbers_list|slice:":3"|join:", " }}
                          {% endif %}
                        </p>
                        <div class="flex items-center justify-between">
                          <span class="badge badge-outline text-xs">
                            <i class="fas fa-eye mr-1"></i>
                            {{ location.views_count }} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                          </span>
                          <div class="text-xs text-muted-foreground">
                            <i class="fas fa-navigation mr-1"></i>
                            ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </a>
              {% empty %}
              <!-- Fallback content if no locations found -->
              <div class="card hover:shadow-md transition-shadow">
                <div class="p-4">
                  <div class="flex gap-4">
                    <div class="w-16 h-16 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0">
                      <i class="fas fa-map-pin text-primary text-xl"></i>
                    </div>
                    <div class="flex-1">
                      <h4 class="font-semibold mb-1 text-foreground">‡∏ß‡∏±‡∏î‡πÑ‡∏ú‡πà‡∏•‡πâ‡∏≠‡∏°</h4>
                      <p class="text-sm text-muted-foreground mb-2">‡∏ß‡∏±‡∏î‡∏î‡∏±‡∏á‡∏Ç‡∏≠‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡πá‡∏î ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡∏ö‡πà‡∏≠‡∏¢: 27, 72, 07</p>
                      <div class="flex items-center justify-between">
                        <span class="badge badge-outline text-xs">
                          <i class="fas fa-star mr-1"></i>
                          ‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°
                        </span>
                        <div class="text-xs text-muted-foreground">
                          <i class="fas fa-navigation mr-1"></i>
                          ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="card hover:shadow-md transition-shadow">
                <div class="p-4">
                  <div class="flex gap-4">
                    <div class="w-16 h-16 bg-secondary/10 rounded-lg flex items-center justify-center flex-shrink-0">
                      <i class="fas fa-map-pin text-secondary text-xl"></i>
                    </div>
                    <div class="flex-1">
                      <h4 class="font-semibold mb-1 text-foreground">‡∏®‡∏≤‡∏•‡πÄ‡∏à‡πâ‡∏≤‡∏û‡πà‡∏≠‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏°‡∏∑‡∏≠‡∏á</h4>
                      <p class="text-sm text-muted-foreground mb-2">‡∏®‡∏≤‡∏•‡πÄ‡∏à‡πâ‡∏≤‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå ‡πÄ‡∏•‡∏Ç‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: 89, 98, 19</p>
                      <div class="flex items-center justify-between">
                        <span class="badge badge-secondary text-xs">
                          <i class="fas fa-trophy mr-1"></i>
                          ‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏™‡∏π‡∏á
                        </span>
                        <div class="text-xs text-muted-foreground">
                          <i class="fas fa-navigation mr-1"></i>
                          ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>

            <div class="mt-6 text-center">
              <a href="/lucky_spots/" class="btn btn-outline">
                <i class="fas fa-map-pin mr-2"></i>
                ‡∏î‡∏π‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÄ‡∏•‡∏Ç‡πÄ‡∏î‡πá‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
              </a>
            </div>
          </div>

          <!-- Dream Interpretation -->
          <div>
            <h3 class="text-2xl font-serif font-bold text-foreground mb-6 flex items-center gap-2">
              <i class="fas fa-moon text-primary"></i>
              ‡πÅ‡∏õ‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ù‡∏±‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
            </h3>

            <div class="card">
              <div class="p-6">
                <div class="space-y-4">
                  <div class="bg-muted/50 p-4 rounded-lg">
                    <h4 class="font-semibold mb-2 text-foreground">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ù‡∏±‡∏ô‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°: "‡∏ù‡∏±‡∏ô‡πÄ‡∏´‡πá‡∏ô‡∏á‡∏π‡πÉ‡∏´‡∏ç‡πà‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß"</h4>
                    <p class="text-sm text-muted-foreground mb-3">
                      ‡∏á‡∏π‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÉ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ù‡∏±‡∏ô‡πÅ‡∏ó‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ‡πÅ‡∏•‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏≠‡∏á ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏•‡∏Ç 89, 98, 08
                    </p>
                    <div class="flex gap-2">
                      <span class="badge badge-outline">89</span>
                      <span class="badge badge-outline">98</span>
                      <span class="badge badge-outline">08</span>
                    </div>
                  </div>

                  <div class="space-y-3">
                    <textarea 
                      id="dreamInput"
                      placeholder="‡πÄ‡∏•‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ù‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..." 
                      rows="3" 
                      class="textarea resize-none"
                    ></textarea>
                    <button onclick="interpretDream()" id="dreamBtn" class="btn btn-primary w-full">
                      <i class="fas fa-moon mr-2"></i>
                      ‡πÅ‡∏õ‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ù‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
                    </button>
                  </div>

                  <!-- Loading -->
                  <div id="dreamLoading" class="hidden text-center py-4">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
                    <p class="mt-2 text-muted-foreground">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ù‡∏±‡∏ô...</p>
                  </div>
                  
                  <!-- Results -->
                  <div id="dreamResults" class="hidden">
                    <div class="bg-primary/10 rounded-lg p-4 mb-4">
                      <h4 class="font-semibold text-primary mb-2">‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢:</h4>
                      <p id="dreamInterpretation" class="text-foreground"></p>
                    </div>
                    
                    <div class="bg-muted/50 rounded-lg p-4 mb-4">
                      <h4 class="font-semibold text-foreground mb-3">‡πÄ‡∏•‡∏Ç‡∏°‡∏á‡∏Ñ‡∏•‡∏à‡∏≤‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ù‡∏±‡∏ô:</h4>
                      <div id="dreamNumbers" class="grid grid-cols-3 gap-3"></div>
                    </div>
                    
                    <button onclick="resetDreamForm()" class="btn btn-outline w-full">
                      ‡∏ï‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Sidebar -->
        <div class="space-y-6">
          <!-- Quick Lottery Check -->
          <div class="card">
            <div class="p-4 border-b">
              <h3 class="font-serif flex items-center gap-2 text-lg font-bold text-foreground">
                <i class="fas fa-search text-primary"></i>
                ‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏ß‡∏¢‡∏î‡πà‡∏ß‡∏ô
              </h3>
            </div>
            <div class="p-4 space-y-3">
              <input 
                id="lotteryInput"
                placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç 6 ‡∏´‡∏•‡∏±‡∏Å" 
                class="input"
                maxlength="6"
                pattern="[0-9]{6}"
              />
              <button onclick="checkLottery()" id="lotteryBtn" class="btn btn-primary w-full">‡∏ï‡∏£‡∏ß‡∏à‡∏ú‡∏•‡∏´‡∏ß‡∏¢</button>
              <a href="/lottery_checker/" class="btn btn-outline w-full">
                <i class="fas fa-search mr-2"></i>
                ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏ß‡∏¢‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
              </a>
              {% if latest_lottery_result %}
              <div class="text-xs text-muted-foreground text-center">‡∏á‡∏ß‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: {{ latest_lottery_result.formatted_date }}</div>
              {% endif %}

              <!-- Loading -->
              <div id="lotteryLoading" class="hidden text-center py-4">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
                <p class="mt-2 text-muted-foreground">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</p>
              </div>
              
              <!-- Results -->
              <div id="lotteryResults" class="hidden">
                <div class="bg-primary/10 rounded-lg p-4 mb-4">
                  <h4 class="font-semibold text-primary mb-2">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:</h4>
                  <div id="lotteryResultText" class="text-foreground"></div>
                </div>
                
                <button onclick="resetLotteryForm()" class="btn btn-outline w-full">
                  ‡∏ï‡∏£‡∏ß‡∏à‡πÉ‡∏´‡∏°‡πà
                </button>
              </div>
            </div>
          </div>

          <!-- Hot Numbers -->
          <div class="card">
            <div class="p-4 border-b">
              <h3 class="font-serif flex items-center gap-2 text-lg font-bold text-foreground">
                <i class="fas fa-chart-bar text-secondary"></i>
                ‡πÄ‡∏•‡∏Ç‡∏Æ‡∏¥‡∏ï‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå
              </h3>
            </div>
            <div class="p-4">
              <div class="space-y-3">
                <div class="flex justify-between items-center">
                  <span class="text-sm text-foreground">‡πÄ‡∏•‡∏Ç‡∏≠‡∏≠‡∏Å‡∏ö‡πà‡∏≠‡∏¢</span>
                  <div class="flex gap-1">
                    <span class="badge badge-secondary">07</span>
                    <span class="badge badge-secondary">23</span>
                    <span class="badge badge-secondary">45</span>
                  </div>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm text-foreground">‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏≠‡∏≠‡∏Å</span>
                  <div class="flex gap-1">
                    <span class="badge badge-outline">89</span>
                    <span class="badge badge-outline">91</span>
                    <span class="badge badge-outline">96</span>
                  </div>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm text-foreground">‡πÄ‡∏•‡∏Ç‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏™‡∏π‡∏á</span>
                  <div class="flex gap-1">
                    <span class="badge bg-accent text-accent-foreground">12</span>
                    <span class="badge bg-accent text-accent-foreground">34</span>
                    <span class="badge bg-accent text-accent-foreground">56</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- AI Prediction -->
          <div class="card border-primary/20">
            <div class="p-4 border-b">
              <h3 class="font-serif flex items-center gap-2 text-lg font-bold text-foreground">
                <i class="fas fa-brain text-primary"></i>
                AI ‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà
              </h3>
            </div>
            <div class="p-4">
              <div class="text-center space-y-4">
                <div>
                  {% if latest_prediction %}
                    <div class="text-2xl font-bold text-primary mb-1">{{ latest_prediction.get_three_digit_list.0|default:"427" }}</div>
                    <div class="text-sm text-muted-foreground">‡πÄ‡∏•‡∏Ç‡∏ö‡∏ô 3 ‡∏ï‡∏±‡∏ß</div>
                    <div class="badge bg-primary/10 text-primary mt-2">{{ latest_prediction.overall_confidence|floatformat:0|default:"87" }}% ‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥</div>
                  {% else %}
                    <div class="text-2xl font-bold text-primary mb-1">427</div>
                    <div class="text-sm text-muted-foreground">‡πÄ‡∏•‡∏Ç‡∏ö‡∏ô 3 ‡∏ï‡∏±‡∏ß</div>
                    <div class="badge bg-primary/10 text-primary mt-2">87% ‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥</div>
                  {% endif %}
                </div>
                <a href="/ai/" class="btn btn-primary w-full">
                  <i class="fas fa-bolt mr-2"></i>
                  ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏•‡∏Ç‡πÉ‡∏´‡∏°‡πà
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>


<script>
// Instant Lucky Numbers Functionality
class InstantLuckyNumbers {
    constructor() {
        this.apiEndpoint = '/api/instant-lucky-numbers/';
        this.newsApiEndpoint = '/api/recent-news-selection/';
        this.selectedNewsIds = [];
        this.init();
    }

    init() {
        const generateBtn = document.getElementById('generateBtn');
        const generateAgainBtn = document.getElementById('generateAgainBtn');
        const loadNewsBtn = document.getElementById('loadNewsBtn');
        const clearNewsBtn = document.getElementById('clearNewsBtn');
        
        if (generateBtn) {
            generateBtn.addEventListener('click', () => this.generateNumbers());
        }
        
        if (generateAgainBtn) {
            generateAgainBtn.addEventListener('click', () => this.generateNumbers());
        }
        
        if (loadNewsBtn) {
            loadNewsBtn.addEventListener('click', () => this.loadRecentNews());
        }
        
        if (clearNewsBtn) {
            clearNewsBtn.addEventListener('click', () => this.clearNewsSelection());
        }
    }

    async generateNumbers() {
        const dateInput = document.getElementById('significantDate');
        const loadingState = document.getElementById('loadingState');
        const resultsSection = document.getElementById('instantLuckyResults');

        // Show loading
        this.showLoading(true);
        resultsSection.classList.add('hidden');

        try {
            const payload = {};
            if (dateInput && dateInput.value) {
                payload.significant_date = dateInput.value;
            }
            if (this.selectedNewsIds && this.selectedNewsIds.length > 0) {
                payload.selected_news_ids = this.selectedNewsIds;
            }

            const response = await fetch(this.apiEndpoint, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': this.getCsrfToken()
                },
                body: JSON.stringify(payload)
            });

            const data = await response.json();

            if (data.success) {
                this.displayResults(data.data);
            } else {
                this.showError(data.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
            }

        } catch (error) {
            console.error('Error generating lucky numbers:', error);
            this.showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
        } finally {
            this.showLoading(false);
        }
    }

    displayResults(data) {
        // Update subtitle
        const subtitle = document.getElementById('resultsSubtitle');
        subtitle.textContent = `‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${this.formatThaiDate(data.significant_date)}`;

        // Display lucky numbers
        this.displayLuckyNumbers(data.lucky_numbers);

        // Display insights
        this.displayInsights(data.insights);

        // Display thai fortune message
        const thaiMessage = document.getElementById('thaiMessage');
        thaiMessage.textContent = data.insights.thai_message;

        // Display number sources
        this.displayNumberSources(data.lucky_numbers);

        // Show results
        document.getElementById('instantLuckyResults').classList.remove('hidden');
        
        // Smooth scroll to results
        document.getElementById('instantLuckyResults').scrollIntoView({ 
            behavior: 'smooth', 
            block: 'start' 
        });
    }

    displayLuckyNumbers(numbers) {
        const grid = document.getElementById('luckyNumbersGrid');
        grid.innerHTML = '';

        numbers.forEach((numberInfo, index) => {
            const numberElement = document.createElement('div');
            numberElement.className = 'relative group';
            
            // Animate appearance
            numberElement.style.animationDelay = `${index * 100}ms`;
            numberElement.className += ' animate-fade-in';

            numberElement.innerHTML = `
                <div class="w-20 h-20 bg-gradient-to-br from-green-500 to-emerald-600 text-white rounded-xl flex items-center justify-center font-bold text-2xl shadow-lg hover:scale-110 transition-all duration-300 group-hover:shadow-2xl cursor-pointer"
                     title="${numberInfo.reason}">
                    ${numberInfo.number}
                </div>
                <div class="absolute -top-2 -right-2 w-6 h-6 bg-yellow-500 text-white rounded-full flex items-center justify-center text-xs font-bold">
                    ${Math.round(numberInfo.confidence / 10)}
                </div>
                <div class="mt-2 text-xs text-center text-green-700 font-medium">
                    ${this.getSourceIcon(numberInfo.source)} ${this.getSourceName(numberInfo.source)}
                </div>
            `;

            grid.appendChild(numberElement);
        });
    }

    displayInsights(insights) {
        const statsDiv = document.getElementById('insightStats');
        
        statsDiv.innerHTML = `
            <div class="space-y-2">
                <div class="flex justify-between">
                    <span>‡πÄ‡∏•‡∏Ç‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
                    <span class="font-semibold">${insights.total_numbers} ‡∏ï‡∏±‡∏ß</span>
                </div>
                <div class="flex justify-between">
                    <span>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢:</span>
                    <span class="font-semibold">${Math.round(insights.confidence_range.average)}%</span>
                </div>
                <div class="flex justify-between">
                    <span>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î:</span>
                    <span class="font-semibold">${insights.confidence_range.highest}%</span>
                </div>
                ${insights.special_patterns.length > 0 ? `
                <div class="mt-2 pt-2 border-t border-green-200">
                    <div class="text-xs text-green-600">
                        ${insights.special_patterns.join(' ‚Ä¢ ')}
                    </div>
                </div>
                ` : ''}
            </div>
        `;
    }

    displayNumberSources(numbers) {
        const sourcesDiv = document.getElementById('numberSources');
        const sourceGroups = {};

        // Group numbers by source
        numbers.forEach(num => {
            if (!sourceGroups[num.source]) {
                sourceGroups[num.source] = [];
            }
            sourceGroups[num.source].push(num);
        });

        sourcesDiv.innerHTML = '';
        Object.entries(sourceGroups).forEach(([source, nums]) => {
            const sourceDiv = document.createElement('div');
            sourceDiv.className = 'flex items-center justify-between p-2 bg-white rounded border border-gray-100';
            
            sourceDiv.innerHTML = `
                <div class="flex items-center gap-2">
                    <span class="text-lg">${this.getSourceIcon(source)}</span>
                    <span class="text-sm font-medium">${this.getSourceName(source)}</span>
                </div>
                <div class="flex gap-1">
                    ${nums.map(num => `
                        <span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs font-mono">
                            ${num.number}
                        </span>
                    `).join('')}
                </div>
            `;
            
            sourcesDiv.appendChild(sourceDiv);
        });
    }

    getSourceIcon(source) {
        const icons = {
            'day': 'üìÖ',
            'month': 'üóìÔ∏è',
            'year': '‚è∞',
            'date_sum': '‚ûï',
            'weekday': 'üìÜ',
            'news': 'üì∞',
            'mixed_sum': 'üî¢',
            'mixed_diff': '‚ûñ',
            'hash': 'üîÆ'
        };
        return icons[source] || 'üéØ';
    }

    getSourceName(source) {
        const names = {
            'day': '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà',
            'day_tens': '‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏¥‡∏ö',
            'month': '‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',
            'year': '‡∏õ‡∏µ',
            'date_sum': '‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô+‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',
            'weekday': '‡∏ß‡∏±‡∏ô‡πÉ‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå',
            'news': '‡∏Ç‡πà‡∏≤‡∏ß‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î',
            'mixed_sum': '‡∏ú‡∏•‡∏£‡∏ß‡∏°',
            'mixed_diff': '‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á',
            'hash': '‡∏≠‡∏±‡∏•‡∏Å‡∏≠‡∏£‡∏¥‡∏ó‡∏∂‡∏°'
        };
        return names[source] || source;
    }

    showLoading(show) {
        const loadingState = document.getElementById('loadingState');
        if (show) {
            loadingState.classList.remove('hidden');
        } else {
            loadingState.classList.add('hidden');
        }
    }

    showError(message) {
        alert(message);
    }

    formatThaiDate(dateStr) {
        const date = new Date(dateStr);
        const thaiMonths = [
            '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô',
            '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'
        ];
        
        const day = date.getDate();
        const month = thaiMonths[date.getMonth()];
        const year = date.getFullYear() + 543; // Convert to Buddhist Era
        
        return `${day} ${month} ${year}`;
    }

    getCsrfToken() {
        const name = 'csrftoken';
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    async loadRecentNews() {
        const loadingState = document.getElementById('newsLoadingState');
        const selectionArea = document.getElementById('newsSelectionArea');
        const loadNewsBtn = document.getElementById('loadNewsBtn');
        const clearNewsBtn = document.getElementById('clearNewsBtn');

        // Show loading
        loadingState.classList.remove('hidden');
        loadNewsBtn.disabled = true;

        try {
            const response = await fetch(this.newsApiEndpoint, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            const data = await response.json();

            if (data.success) {
                this.displayNewsOptions(data.data.news_articles);
                selectionArea.classList.remove('hidden');
                clearNewsBtn.classList.remove('hidden');
                loadNewsBtn.textContent = '‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà';
            } else {
                this.showError(data.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πà‡∏≤‡∏ß');
            }

        } catch (error) {
            console.error('Error loading news:', error);
            this.showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
        } finally {
            loadingState.classList.add('hidden');
            loadNewsBtn.disabled = false;
        }
    }

    displayNewsOptions(newsArticles) {
        const container = document.getElementById('newsCheckboxList');
        container.innerHTML = '';

        newsArticles.forEach(article => {
            const newsItem = document.createElement('div');
            newsItem.className = 'flex items-start gap-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-100 transition-colors';
            
            // Confidence color
            const confidenceColor = article.lottery_relevance_score >= 90 ? 'text-red-600' : 
                                   article.lottery_relevance_score >= 70 ? 'text-orange-600' : 'text-yellow-600';
            
            newsItem.innerHTML = `
                <input type="checkbox" id="news_${article.id}" value="${article.id}" 
                       class="mt-1 w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500"
                       onchange="instantLucky.handleNewsSelection(this)">
                <label for="news_${article.id}" class="flex-1 cursor-pointer">
                    <div class="flex items-center justify-between mb-1">
                        <span class="text-sm font-medium text-gray-900 line-clamp-2">${article.title}</span>
                        <span class="text-xs ${confidenceColor} font-semibold ml-2">${article.confidence_level}</span>
                    </div>
                    <div class="flex items-center gap-3 text-xs text-gray-500">
                        <span class="bg-blue-100 px-2 py-1 rounded">${article.category}</span>
                        <span>${article.published_date}</span>
                        <span>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${article.lottery_relevance_score}</span>
                    </div>
                    <div class="mt-2 text-xs text-green-700">
                        ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏™‡∏Å‡∏±‡∏î‡πÑ‡∏î‡πâ: ${article.extracted_numbers.join(', ') || '‡πÑ‡∏°‡πà‡∏°‡∏µ'}
                    </div>
                </label>
            `;
            
            container.appendChild(newsItem);
        });
    }

    handleNewsSelection(checkbox) {
        const newsId = parseInt(checkbox.value);
        
        if (checkbox.checked) {
            if (!this.selectedNewsIds.includes(newsId)) {
                this.selectedNewsIds.push(newsId);
            }
        } else {
            this.selectedNewsIds = this.selectedNewsIds.filter(id => id !== newsId);
        }
        
        this.updateNewsSelectionCount();
    }

    updateNewsSelectionCount() {
        const countElement = document.getElementById('selectedNewsCount');
        if (countElement) {
            countElement.textContent = `‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß: ${this.selectedNewsIds.length} ‡∏Ç‡πà‡∏≤‡∏ß`;
        }
    }

    clearNewsSelection() {
        // Clear selection
        this.selectedNewsIds = [];
        
        // Clear checkboxes
        const checkboxes = document.querySelectorAll('#newsCheckboxList input[type="checkbox"]');
        checkboxes.forEach(cb => cb.checked = false);
        
        // Hide selection area
        document.getElementById('newsSelectionArea').classList.add('hidden');
        document.getElementById('clearNewsBtn').classList.add('hidden');
        
        // Reset button text
        const loadNewsBtn = document.getElementById('loadNewsBtn');
        loadNewsBtn.textContent = '‡∏î‡∏π‡∏Ç‡πà‡∏≤‡∏ß‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î';
        
        // Update count
        this.updateNewsSelectionCount();
    }
}

// Initialize when DOM is loaded
let instantLucky;
document.addEventListener('DOMContentLoaded', function() {
    instantLucky = new InstantLuckyNumbers();
});

// Dream Interpretation Functions
async function interpretDream() {
    const dreamInput = document.getElementById('dreamInput');
    const dreamBtn = document.getElementById('dreamBtn');
    const dreamLoading = document.getElementById('dreamLoading');
    const dreamResults = document.getElementById('dreamResults');
    
    const dreamText = dreamInput.value.trim();
    
    if (!dreamText) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ù‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì');
        return;
    }
    
    // Show loading
    dreamLoading.classList.remove('hidden');
    dreamBtn.disabled = true;
    dreamResults.classList.add('hidden');
    
    try {
        const response = await fetch('/dreams/analyze/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify({
                dream_text: dreamText
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            // Show results
            document.getElementById('dreamInterpretation').textContent = data.result.interpretation;
            
            // Show numbers
            const numbersContainer = document.getElementById('dreamNumbers');
            numbersContainer.innerHTML = '';
            
            data.result.numbers.forEach(number => {
                const div = document.createElement('div');
                div.className = 'bg-card border border-border rounded-lg p-3 text-center';
                div.innerHTML = `<span class="text-xl font-bold text-primary">${number}</span>`;
                numbersContainer.appendChild(div);
            });
            
            dreamResults.classList.remove('hidden');
        } else {
            alert(data.error || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
        }
    } catch (error) {
        alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
    } finally {
        dreamLoading.classList.add('hidden');
        dreamBtn.disabled = false;
    }
}

function resetDreamForm() {
    document.getElementById('dreamInput').value = '';
    document.getElementById('dreamResults').classList.add('hidden');
    document.getElementById('dreamLoading').classList.add('hidden');
    document.getElementById('dreamBtn').disabled = false;
}

// Lottery Checker Functions
async function checkLottery() {
    const lotteryInput = document.getElementById('lotteryInput');
    const lotteryBtn = document.getElementById('lotteryBtn');
    const lotteryLoading = document.getElementById('lotteryLoading');
    const lotteryResults = document.getElementById('lotteryResults');
    const lotteryResultText = document.getElementById('lotteryResultText');

    const lotteryNumber = lotteryInput.value.trim();

    if (!lotteryNumber) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏™‡∏•‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à');
        return;
    }

    if (!/^\d{6}$/.test(lotteryNumber)) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç 6 ‡∏´‡∏•‡∏±‡∏Å');
        return;
    }

    // Show loading
    lotteryLoading.classList.remove('hidden');
    lotteryBtn.disabled = true;
    lotteryResults.classList.add('hidden');
    lotteryResultText.textContent = ''; // Clear previous results

    try {
        const response = await fetch('/lottery_checker/api/check/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify({
                lottery_number: lotteryNumber
            })
        });

        const data = await response.json();

        if (data.success) {
            // Show results with color coding
            const resultDiv = document.createElement('div');
            if (data.result.is_winner) {
                resultDiv.innerHTML = `
                    <div class="text-green-600 font-bold mb-2">üéâ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢!</div>
                    <div class="text-foreground">${data.result.message}</div>
                `;
                resultDiv.className = 'p-3 bg-green-50 border border-green-200 rounded-lg';
            } else {
                resultDiv.innerHTML = `
                    <div class="text-orange-600 font-bold mb-2">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</div>
                    <div class="text-foreground">${data.result.message}</div>
                `;
                resultDiv.className = 'p-3 bg-orange-50 border border-orange-200 rounded-lg';
            }
            
            lotteryResultText.innerHTML = '';
            lotteryResultText.appendChild(resultDiv);
            lotteryResults.classList.remove('hidden');
        } else {
            lotteryResultText.innerHTML = `
                <div class="p-3 bg-red-50 border border-red-200 rounded-lg">
                    <div class="text-red-600 font-bold mb-2">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</div>
                    <div class="text-foreground">${data.error || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà'}</div>
                </div>
            `;
            lotteryResults.classList.remove('hidden');
        }
    } catch (error) {
        lotteryResultText.innerHTML = `
            <div class="p-3 bg-red-50 border border-red-200 rounded-lg">
                <div class="text-red-600 font-bold mb-2">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</div>
                <div class="text-foreground">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ</div>
            </div>
        `;
        lotteryResults.classList.remove('hidden');
    } finally {
        lotteryLoading.classList.add('hidden');
        lotteryBtn.disabled = false;
    }
}

function resetLotteryForm() {
    document.getElementById('lotteryInput').value = '';
    document.getElementById('lotteryResults').classList.add('hidden');
    document.getElementById('lotteryLoading').classList.add('hidden');
    document.getElementById('lotteryResultText').textContent = '';
    document.getElementById('lotteryBtn').disabled = false;
}

// Utility function to get CSRF token
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Enter key support for inputs
document.addEventListener('DOMContentLoaded', function() {
    const dreamInput = document.getElementById('dreamInput');
    if (dreamInput) {
        dreamInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                interpretDream();
            }
        });
    }
    
    const lotteryInput = document.getElementById('lotteryInput');
    if (lotteryInput) {
        lotteryInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkLottery();
            }
        });
    }
});

// Scroll to Instant Lucky Numbers section
function scrollToInstantSection() {
    const section = document.querySelector('#instantLuckyNumbers');
    if (section) {
        section.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'start' 
        });
    }
}
</script>

{% block extra_js %}
<script src="{% static 'js/theme.js' %}"></script>
{% endblock %}
{% endblock %}