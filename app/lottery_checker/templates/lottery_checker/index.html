{% extends 'base.html' %}
{% load static %}

{% block title %}‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏ß‡∏¢ - LekDedAI{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 py-8">
    <div class="container mx-auto px-4">
        <!-- Header Section -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏ß‡∏¢</h1>
            <p class="text-lg text-gray-600">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏•‡∏Ç‡∏´‡∏ß‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏±‡∏ö‡∏ú‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</p>
        </div>

        <!-- Main Form Section -->
        <div class="max-w-2xl mx-auto bg-white rounded-2xl shadow-xl p-8 mb-8">
            <div class="mb-6">
                <label class="block text-lg font-semibold text-gray-700 mb-3">
                    üìù ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏™‡∏•‡∏≤‡∏Å (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 10 ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç, ‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≠‡∏°‡∏°‡∏≤)
                </label>
                <input 
                    type="text" 
                    id="lottoInput" 
                    placeholder="‡πÄ‡∏ä‡πà‡∏ô 123456, 654321, 789012" 
                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all duration-300 text-lg"
                    onkeypress="handleEnterKey(event)"
                >
            </div>

            <div class="mb-6">
                <label class="block text-lg font-semibold text-gray-700 mb-3">
                    üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
                </label>
                <select 
                    id="lottoDate" 
                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all duration-300 text-lg"
                >
                    <option value="2025-08-01">1 ‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏° 2568</option>
                    <option value="2025-07-16">16 ‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏° 2568</option>
                    <option value="2025-07-01">1 ‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏° 2568</option>
                    <option value="2025-06-16">16 ‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô 2568</option>
                    <option value="2025-06-01">1 ‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô 2568</option>
                    <option value="2025-05-16">16 ‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏° 2568</option>
                    <option value="2025-05-02">2 ‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏° 2568</option>
                    <option value="2025-04-16">16 ‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô 2568</option>
                    <option value="2025-04-01">1 ‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô 2568</option>
                    <option value="2025-03-16">16 ‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏° 2568</option>
                    <option value="2025-03-01">1 ‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏° 2568</option>
                    <option value="2025-02-16">16 ‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå 2568</option>
                    <option value="2025-02-01">1 ‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå 2568</option>
                    <option value="2025-01-17">17 ‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏° 2568</option>
                    <option value="2025-01-02">2 ‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏° 2568</option>
                </select>
            </div>

            <button 
                onclick="checkLottoAndLoadFullResults()" 
                class="w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-bold py-4 px-6 rounded-xl text-xl transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl"
            >
                üéØ ‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏ß‡∏¢
            </button>

            <!-- Result Display -->
            <div id="lottoResult" class="mt-6 p-4 bg-gray-50 rounded-xl border-l-4 border-purple-500 hidden">
                <!-- Results will be displayed here -->
            </div>
        </div>

        <!-- Lottery Results Display Section -->
        <div class="max-w-6xl mx-auto bg-white rounded-2xl shadow-xl p-8">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-gray-800">üèÜ ‡∏ú‡∏•‡∏™‡∏•‡∏≤‡∏Å‡∏Å‡∏¥‡∏ô‡πÅ‡∏ö‡πà‡∏á‡∏£‡∏±‡∏ê‡∏ö‡∏≤‡∏•</h2>
            </div>
            <div id="latestLottoResult" class="text-center text-gray-600 text-lg">
                <div class="animate-pulse">
                    <div class="inline-block w-8 h-8 bg-purple-400 rounded-full mb-4"></div>
                    <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•...</p>
                </div>
            </div>
            
            <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏Å‡∏≠‡∏á‡∏™‡∏•‡∏≤‡∏Å -->
            <div class="text-center mt-8 pt-8 border-t border-gray-200">
                <button 
                    onclick="refreshDataFromGLO()" 
                    class="bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-bold py-4 px-8 rounded-xl text-lg transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl"
                >
                    üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏Å‡∏≠‡∏á‡∏™‡∏•‡∏≤‡∏Å
                </button>
                <p class="text-sm text-gray-500 mt-3">‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å API ‡∏Å‡∏≠‡∏á‡∏™‡∏•‡∏≤‡∏Å</p>
            </div>
        </div>
    </div>
</div>

<script>
// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
function formatThaiDate(selectedDate) {
    const monthNamesThai = [
        "‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå", "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°", "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô", "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°", "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô",
        "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°", "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô", "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°", "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô", "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"
    ];
    
    const dateParts = selectedDate.split('-');
    const year = parseInt(dateParts[0]);
    const month = parseInt(dateParts[1]);
    const date = parseInt(dateParts[2]);
    
    const thaiMonth = monthNamesThai[month - 1];
    const thaiYear = year + 543;
    
    return `${date} ${thaiMonth} ${thaiYear}`;
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏ß‡∏¢"
async function checkLottoAndLoadFullResults() {
    const selectedDate = document.getElementById("lottoDate").value;
    
    // 1. ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏ß‡∏¢‡∏£‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç
    await checkLotto(selectedDate);

    // 2. ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    await loadLottoResultsForDate(selectedDate);
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
async function loadLottoResultsForDate(selectedDateFull) {
    const displayDiv = document.getElementById("latestLottoResult");
    displayDiv.innerHTML = `
        <div class="animate-pulse">
            <div class="inline-block w-8 h-8 bg-purple-400 rounded-full mb-4"></div>
            <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•...</p>
        </div>
    `;

    const dateParts = selectedDateFull.split('-');
    const year = dateParts[0];
    const month = dateParts[1];
    const date = dateParts[2];

    const payload = {
        date: date,
        month: month,
        year: year
    };

    try {
        const res = await fetch("/lottery_checker/api/lotto/result/", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(payload)
        });

        const data = await res.json();
        console.log("Full Lotto Results API Response:", data);

        if (!data || !data.success) {
            displayDiv.innerHTML = `
                <div class="text-red-500 text-xl font-semibold text-center">
                    <div class="mb-4">
                        <svg class="w-16 h-16 mx-auto text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                        </svg>
                    </div>
                    <p>‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÑ‡∏î‡πâ</p>
                    <p class="text-sm text-gray-600 mt-2">${data.error || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏'}</p>
                </div>
            `;
            return;
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        if (!data.data || !data.data.response || !data.data.response.result || !data.data.response.result.data) {
            displayDiv.innerHTML = `
                <div class="text-orange-500 text-xl font-semibold text-center">
                    <div class="mb-4">
                        <svg class="w-16 h-16 mx-auto text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                        </svg>
                    </div>
                    <p>‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏ß‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${formatThaiDate(selectedDateFull)}</p>
                    <p class="text-sm text-gray-600 mt-2">‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• ‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï</p>
                </div>
            `;
            return;
        }
        
        const lottoData = data.data.response.result.data;
        const formattedDate = formatThaiDate(selectedDateFull);
        const period = data.data.response.result.period && data.data.response.result.period.length > 0 ? data.data.response.result.period[0] : 'N/A';

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        const validationResult = validateLottoData(lottoData);
        if (!validationResult.is_valid) {
            displayDiv.innerHTML = `
                <div class="text-red-500 text-xl font-semibold text-center">
                    <div class="mb-4">
                        <svg class="w-16 h-16 mx-auto text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                        </svg>
                    </div>
                    <p>üö® ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏ß‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${formattedDate}</p>
                    <p class="text-sm text-gray-600 mt-2">${validationResult.error}</p>
                </div>
            `;
            return;
        }

        let htmlContent = `
            <div class="mb-8">
                <h3 class="text-2xl font-bold text-gray-800 mb-2">‡∏á‡∏ß‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${formattedDate}</h3>
                <p class="text-gray-600">‡∏á‡∏ß‡∏î‡∏ó‡∏µ‡πà ${period}</p>
            </div>
        `;

        // ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 1
        const firstPrizeNumber = lottoData.first?.number[0]?.value || 'N/A';
        
        // ‡πÄ‡∏•‡∏Ç‡∏´‡∏ô‡πâ‡∏≤ 3 ‡∏ï‡∏±‡∏ß ‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏Ç‡∏ó‡πâ‡∏≤‡∏¢ 3 ‡∏ï‡∏±‡∏ß
        let front3Numbers = 'N/A';
        let last3Numbers = 'N/A';
        let last2Number = 'N/A';

        if (lottoData.last3f?.number) {
            front3Numbers = lottoData.last3f.number.map(item => item.value).join(' ');
        }
        
        if (lottoData.last3b?.number) {
            last3Numbers = lottoData.last3b.number.map(item => item.value).join(' ');
        }
        
        if (lottoData.last2?.number) {
            last2Number = lottoData.last2.number[0].value;
        }

        // ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á
        let near1Numbers = [];
        if (lottoData.near1?.number) {
            near1Numbers = lottoData.near1.number.map(item => item.value);
        }

        // Prize Grid
        htmlContent += `
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-gradient-to-br from-red-500 to-red-600 text-white p-6 rounded-2xl text-center shadow-lg">
                    <h4 class="text-lg font-semibold mb-2">‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 1</h4>
                    <p class="text-sm mb-3">1 ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÜ 6,000,000 ‡∏ö‡∏≤‡∏ó</p>
                    <div class="text-3xl font-bold">${firstPrizeNumber}</div>
                </div>
                
                <div class="bg-gradient-to-br from-blue-500 to-blue-600 text-white p-6 rounded-2xl text-center shadow-lg">
                    <h4 class="text-lg font-semibold mb-2">‡πÄ‡∏•‡∏Ç‡∏´‡∏ô‡πâ‡∏≤ 3 ‡∏ï‡∏±‡∏ß</h4>
                    <p class="text-sm mb-3">2 ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÜ 4,000 ‡∏ö‡∏≤‡∏ó</p>
                    <div class="text-2xl font-bold">${front3Numbers}</div>
                </div>
                
                <div class="bg-gradient-to-br from-green-500 to-green-600 text-white p-6 rounded-2xl text-center shadow-lg">
                    <h4 class="text-lg font-semibold mb-2">‡πÄ‡∏•‡∏Ç‡∏ó‡πâ‡∏≤‡∏¢ 3 ‡∏ï‡∏±‡∏ß</h4>
                    <p class="text-sm mb-3">2 ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÜ 4,000 ‡∏ö‡∏≤‡∏ó</p>
                    <div class="text-2xl font-bold">${last3Numbers}</div>
                </div>
                
                <div class="bg-gradient-to-br from-purple-500 to-purple-600 text-white p-6 rounded-2xl text-center shadow-lg">
                    <h4 class="text-lg font-semibold mb-2">‡πÄ‡∏•‡∏Ç‡∏ó‡πâ‡∏≤‡∏¢ 2 ‡∏ï‡∏±‡∏ß</h4>
                    <p class="text-sm mb-3">1 ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÜ 2,000 ‡∏ö‡∏≤‡∏ó</p>
                    <div class="text-2xl font-bold">${last2Number}</div>
                </div>
            </div>
        `;

        // ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á
        if (near1Numbers.length > 0) {
            htmlContent += `
                <div class="bg-gradient-to-br from-yellow-500 to-orange-500 text-white p-6 rounded-2xl text-center shadow-lg mb-8">
                    <h4 class="text-xl font-semibold mb-2">‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 1</h4>
                    <p class="text-sm mb-3">2 ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÜ 100,000 ‡∏ö‡∏≤‡∏ó</p>
                    <div class="text-2xl font-bold">${near1Numbers.join(' ')}</div>
                </div>
            `;
        }

        // ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 2
        if (lottoData.second?.number && lottoData.second.number.length > 0) {
            htmlContent += `
                <div class="mb-8">
                    <h4 class="text-2xl font-bold text-gray-800 text-center mb-4">‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 2 (5 ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÜ 200,000 ‡∏ö‡∏≤‡∏ó)</h4>
                    <div class="flex flex-wrap justify-center gap-3">
            `;
            lottoData.second.number.forEach(item => {
                htmlContent += `<span class="bg-blue-100 text-blue-800 px-4 py-2 rounded-full font-semibold text-lg">${item.value}</span>`;
            });
            htmlContent += `</div></div>`;
        }

        // ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 3
        if (lottoData.third?.number && lottoData.third.number.length > 0) {
            htmlContent += `
                <div class="mb-8">
                    <h4 class="text-2xl font-bold text-gray-800 text-center mb-4">‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 3 (10 ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÜ 80,000 ‡∏ö‡∏≤‡∏ó)</h4>
                    <div class="flex flex-wrap justify-center gap-3">
            `;
            lottoData.third.number.forEach(item => {
                htmlContent += `<span class="bg-green-100 text-green-800 px-4 py-2 rounded-full font-semibold text-center">${item.value}</span>`;
            });
            htmlContent += `</div></div>`;
        }

        // ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 4
        if (lottoData.fourth?.number && lottoData.fourth.number.length > 0) {
            htmlContent += `
                <div class="mb-8">
                    <h4 class="text-2xl font-bold text-gray-800 text-center mb-4">‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 4 (50 ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÜ 40,000 ‡∏ö‡∏≤‡∏ó)</h4>
                <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3">
            `;
            lottoData.fourth.number.forEach(item => {
                htmlContent += `<span class="bg-purple-100 text-purple-800 px-3 py-2 rounded-lg font-semibold text-center">${item.value}</span>`;
            });
            htmlContent += `</div></div>`;
        }

        // ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 5
        if (lottoData.fifth?.number && lottoData.fifth.number.length > 0) {
            htmlContent += `
                <div class="mb-8">
                    <h4 class="text-2xl font-bold text-gray-800 text-center mb-4">‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 5 (100 ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÜ 20,000 ‡∏ö‡∏≤‡∏ó)</h4>
                <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3">
            `;
            lottoData.fifth.number.forEach(item => {
                htmlContent += `<span class="bg-gray-100 text-gray-800 px-3 py-2 rounded-lg font-semibold text-center">${item.value}</span>`;
            });
            htmlContent += `</div></div>`;
        }

        displayDiv.innerHTML = htmlContent;

    } catch (err) {
        console.error("Error loading full lotto results:", err);
        
        displayDiv.innerHTML = `
            <div class="text-red-500 text-xl font-semibold text-center">
                <div class="mb-4">
                    <svg class="w-16 h-16 mx-auto text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                    </svg>
                </div>
                <p>üö® ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</p>
                <p class="text-sm text-gray-600 mt-2">${err.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏'}</p>
            </div>
        `;
    }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏ß‡∏¢‡∏£‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç
async function checkLotto(selectedDate) {
    const input = document.getElementById("lottoInput").value.trim();
    const resultDiv = document.getElementById("lottoResult");

    if (!input) {
        resultDiv.innerHTML = `
            <div class="text-orange-600 text-center">
                <p class="text-lg">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏´‡∏ß‡∏¢‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</p>
            </div>
        `;
        resultDiv.classList.remove('hidden');
        return;
    }

    resultDiv.innerHTML = `
        <div class="text-center">
            <div class="inline-block w-6 h-6 bg-purple-400 rounded-full animate-spin mb-2"></div>
            <p class="text-lg text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</p>
        </div>
    `;
    resultDiv.classList.remove('hidden');

    const numbers = input.split(",").map(n => n.trim()).filter(n => /^\d{6}$/.test(n)).slice(0, 10);

    if (numbers.length === 0) {
        resultDiv.innerHTML = `
            <div class="text-red-600 text-center">
                <p class="text-lg">‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç 6 ‡∏´‡∏•‡∏±‡∏Å ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç</p>
            </div>
        `;
        return;
    }

    const dateParts = selectedDate.split('-');
    const year = dateParts[0];
    const month = dateParts[1];
    const date = dateParts[2];

    try {
        const res = await fetch("/lottery_checker/api/lotto/result/", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                date: date,
                month: month,
                year: year
            })
        });

        const data = await res.json();
        console.log("API Response:", data);

        if (!data || !data.success) {
            resultDiv.innerHTML = `
                <div class="text-red-600 text-center">
                    <p class="text-lg">‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÑ‡∏î‡πâ</p>
                </div>
            `;
            return;
        }

        const lottoData = data.data.response.result.data;
        const formattedDate = formatThaiDate(selectedDate);
        
        let html = `
            <div class="mb-4">
                <h3 class="text-xl font-bold text-gray-800 mb-3">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏á‡∏ß‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${formattedDate}</h3>
            </div>
            <div class="space-y-3">
        `;
        
        for (const number of numbers) {
            let prizes = [];
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 1
            if (lottoData.first?.number[0]?.value === number) {
                prizes.push("‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 1 (6,000,000 ‡∏ö‡∏≤‡∏ó)");
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 2
            if (lottoData.second?.number && lottoData.second.number.some(item => item.value === number)) {
                prizes.push("‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 2 (200,000 ‡∏ö‡∏≤‡∏ó)");
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 3
            if (lottoData.third?.number && lottoData.third.number.some(item => item.value === number)) {
                prizes.push("‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 3 (80,000 ‡∏ö‡∏≤‡∏ó)");
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 4
            if (lottoData.fourth?.number && lottoData.fourth.number.some(item => item.value === number)) {
                prizes.push("‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 4 (40,000 ‡∏ö‡∏≤‡∏ó)");
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 5
            if (lottoData.fifth?.number && lottoData.fifth.number.some(item => item.value === number)) {
                prizes.push("‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 5 (20,000 ‡∏ö‡∏≤‡∏ó)");
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏•‡∏Ç‡∏´‡∏ô‡πâ‡∏≤ 3 ‡∏ï‡∏±‡∏ß (last3f) - ‡πÄ‡∏≠‡∏≤‡πÄ‡∏•‡∏Ç 3 ‡∏ï‡∏±‡∏ß‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡∏Ç 6 ‡∏´‡∏•‡∏±‡∏Å
            const front3Digits = number.substring(0, 3);
            if (lottoData.last3f?.number && lottoData.last3f.number.some(item => item.value === front3Digits)) {
                prizes.push("‡πÄ‡∏•‡∏Ç‡∏´‡∏ô‡πâ‡∏≤ 3 ‡∏ï‡∏±‡∏ß (4,000 ‡∏ö‡∏≤‡∏ó)");
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏•‡∏Ç‡∏ó‡πâ‡∏≤‡∏¢ 3 ‡∏ï‡∏±‡∏ß (last3b) - ‡πÄ‡∏≠‡∏≤‡πÄ‡∏•‡∏Ç 3 ‡∏ï‡∏±‡∏ß‡∏ó‡πâ‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡∏Ç 6 ‡∏´‡∏•‡∏±‡∏Å
            const last3Digits = number.substring(3, 6);
            if (lottoData.last3b?.number && lottoData.last3b.number.some(item => item.value === last3Digits)) {
                prizes.push("‡πÄ‡∏•‡∏Ç‡∏ó‡πâ‡∏≤‡∏¢ 3 ‡∏ï‡∏±‡∏ß (4,000 ‡∏ö‡∏≤‡∏ó)");
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏•‡∏Ç‡∏ó‡πâ‡∏≤‡∏¢ 2 ‡∏ï‡∏±‡∏ß (last2) - ‡πÄ‡∏≠‡∏≤‡πÄ‡∏•‡∏Ç 2 ‡∏ï‡∏±‡∏ß‡∏ó‡πâ‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡∏Ç 6 ‡∏´‡∏•‡∏±‡∏Å
            const last2Digits = number.substring(4, 6);
            if (lottoData.last2?.number && lottoData.last2.number.some(item => item.value === last2Digits)) {
                prizes.push("‡πÄ‡∏•‡∏Ç‡∏ó‡πâ‡∏≤‡∏¢ 2 ‡∏ï‡∏±‡∏ß (2,000 ‡∏ö‡∏≤‡∏ó)");
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 1 (near1)
            if (lottoData.near1?.number && lottoData.near1.number.some(item => item.value === number)) {
                prizes.push("‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà 1 (100,000 ‡∏ö‡∏≤‡∏ó)");
            }
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
            if (prizes.length > 0) {
                const prizeText = prizes.join(", ");
                html += `
                    <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded-r-lg">
                        <div class="flex items-center">
                            <span class="text-green-500 mr-3">üéâ</span>
                            <div>
                                <strong class="text-lg text-gray-800">${number}</strong>
                                <p class="text-green-700 font-medium">${prizeText}</p>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                html += `
                    <div class="bg-gray-50 border-l-4 border-gray-400 p-4 rounded-r-lg">
                        <div class="flex items-center">
                            <span class="text-gray-500 mr-3">‚ùå</span>
                            <div>
                                <strong class="text-lg text-gray-800">${number}</strong>
                                <p class="text-gray-600">‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</p>
                            </div>
                        </div>
                    </div>
                `;
            }
        }
        
        html += `</div>`;
        resultDiv.innerHTML = html;

    } catch (err) {
        console.error("Error during API call:", err);
        resultDiv.innerHTML = `
            <div class="text-red-600 text-center">
                <p class="text-lg">‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö API</p>
            </div>
        `;
    }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏Å‡∏î Enter ‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏´‡∏ß‡∏¢
function handleEnterKey(event) {
    if (event.key === 'Enter') {
        event.preventDefault(); // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£ submit form
        checkLottoAndLoadFullResults();
    }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
function onDateChange() {
    const selectedDate = document.getElementById("lottoDate").value;
    loadLottoResultsForDate(selectedDate);
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ß‡∏¢
function validateLottoData(lottoData) {
    try {
        if (!lottoData || typeof lottoData !== 'object') {
            return {
                is_valid: false,
                error: "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"
            };
        }
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        const requiredFields = ['first', 'second', 'third', 'fourth', 'fifth'];
        const missingFields = [];
        
        for (const field of requiredFields) {
            if (!lottoData[field]) {
                missingFields.push(field);
            } else if (!lottoData[field].number || !Array.isArray(lottoData[field].number)) {
                missingFields.push(field);
            }
        }
        
        if (missingFields.length > 0) {
            return {
                is_valid: false,
                error: `‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô: ‡∏Ç‡∏≤‡∏î ${missingFields.join(', ')}`
            };
        }
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤
        for (const field of requiredFields) {
            if (!lottoData[field].number || lottoData[field].number.length === 0) {
                return {
                    is_valid: false,
                    error: `‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${field} ‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤`
                };
            }
        }
        
        return {
            is_valid: true,
            message: "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"
        };
        
    } catch (error) {
        console.error("Error validating lotto data:", error);
        return {
            is_valid: false,
            error: `‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö: ${error.message}`
        };
    }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏Å‡∏≠‡∏á‡∏™‡∏•‡∏≤‡∏Å
async function refreshDataFromGLO() {
    const selectedDate = document.getElementById("lottoDate").value;
    const displayDiv = document.getElementById("latestLottoResult");
    
    // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï
    displayDiv.innerHTML = `
        <div class="text-center">
            <div class="inline-block w-8 h-8 bg-green-400 rounded-full animate-spin mb-4"></div>
            <p class="text-lg text-gray-600">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å API ‡∏Å‡∏≠‡∏á‡∏™‡∏•‡∏≤‡∏Å...</p>
            <p class="text-sm text-gray-500 mt-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà</p>
        </div>
    `;
    
    const dateParts = selectedDate.split('-');
    const year = dateParts[0];
    const month = dateParts[1];
    const date = dateParts[2];
    
    try {
        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ API refresh ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å‡∏Å‡∏≠‡∏á‡∏™‡∏•‡∏≤‡∏Å
        const res = await fetch("/lottery_checker/api/lotto/refresh/", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                date: date,
                month: month,
                year: year
            })
        });
        
        const data = await res.json();
        console.log("Refresh API Response:", data);
        
        if (data.success) {
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
            displayDiv.innerHTML = `
                <div class="text-center text-green-600">
                    <div class="mb-4">
                        <svg class="w-16 h-16 mx-auto text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                    </div>
                    <p class="text-xl font-semibold">‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</p>
                    <p class="text-sm text-gray-600 mt-2">${data.message}</p>
                    <div class="mt-4">
                        <p class="text-sm text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà...</p>
                    </div>
                </div>
            `;
            
            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            setTimeout(() => {
                loadLottoResultsForDate(selectedDate);
            }, 1000);
            
        } else {
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
            displayDiv.innerHTML = `
                <div class="text-center text-red-600">
                    <div class="mb-4">
                        <svg class="w-16 h-16 mx-auto text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </div>
                    <p class="text-xl font-semibold">‚ùå ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</p>
                    <p class="text-sm text-gray-600 mt-2">${data.error || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏'}</p>
                    <div class="mt-4">
                        <button 
                            onclick="refreshDataFromGLO()" 
                            class="bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg mr-3"
                        >
                            üîÑ ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà
                        </button>
                        <button 
                            onclick="loadLottoResultsForDate(selectedDate)" 
                            class="bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg"
                        >
                            üìã ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°
                        </button>
                    </div>
                </div>
            `;
        }
        
    } catch (err) {
        console.error("Error refreshing lotto data:", err);
        displayDiv.innerHTML = `
            <div class="text-center text-red-600">
                <div class="mb-4">
                    <svg class="w-16 h-16 mx-auto text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </div>
                <p class="text-xl font-semibold">‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</p>
                <p class="text-sm text-gray-600 mt-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                <div class="mt-4">
                    <button 
                        onclick="refreshDataFromGLO()" 
                        class="bg-gradient-to-r from-red-600 to-pink-600 hover:from-red-700 hover:to-pink-700 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg mr-3"
                    >
                        üîÑ ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà
                    </button>
                    <button 
                        onclick="loadLottoResultsForDate(selectedDate)" 
                        class="bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg"
                    >
                        üìã ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°
                    </button>
                </div>
            </div>
        `;
    }
}



// ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
document.addEventListener('DOMContentLoaded', () => {
    const initialSelectedDate = document.getElementById("lottoDate").value;
    loadLottoResultsForDate(initialSelectedDate);
});
</script>
{% endblock %}

